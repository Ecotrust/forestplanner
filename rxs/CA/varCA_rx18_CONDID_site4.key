SCREEN
STATS
STDIDENT
S9454        IDB Plot Number
STDINFO                               50  	      0         0         5
DESIGN            -1         1
INVYEAR         2013
TIMEINT                      5
NUMCYCLE          20
TREEFMT
(I6,I3,F6.0,I1,A3,F5.1,F3.1,F3.0,F3.0,F4.1,I1,6I2,I1,I1,I2,I3,I3,I1,I1,F3.0)
TREEDATA          50
OPEN              50
9454.fvs
TREEDATA          50
TREELIST          0.                   1
TREELIST          0.                   1                   1
CUTLIST           0.                   1
ATRTLIST          0.                   1
STRCLASS           0
NOECHO
ESTAB
OUTPUT             0
END
DELOTAB            1
DELOTAB            2

COMMENT
Override default site index. Corresponds to Site Class IV for PN, WC, and CA
variants.
END
SITECODE          DF       85         1

COMMENT
Define "Offset" value, should be 0 or in multiples of 5 (cycle length).
END
COMPUTE
Offset = 0
END

COMMENT
Determine the year in which repeated commercial thinnings commence (REGENYR).
END
IF               999
BSDI GE 0.65*BSDIMAX
THEN
AGPLABEL
All
COMPUTE
CYC1 = CYCLE
END
ENDIF
IF               999
AGE GE 30 AND CYCLE LE CYC1
THEN
AGPLABEL
All
COMPUTE
REGENYR = YEAR + OFFSET
END
ENDIF
IF               999
AGE LT 30 AND CYCLE LE CYC1
THEN 
AGPLABEL
All
COMPUTE
REGENYR = (30 + OFFSET - AGE) + YEAR
END
ENDIF

COMMENT
Create a code indicating what type (if any) of harvesting occurred each cycle.
CUT_TYPE codes:
0 = No cut this cycle
1 = Pre-commercial thin this cycle
2 = Commercial thin this cycle
3 = Regeneration harvest this cycle
END
IF 
EVPHASE EQ 2
THEN
AGPLABEL
All
COMPUTE            0
CUT_TYPE = LININT(Age,30+Offset,30+Offset,0,2)*CUT
END
ENDIF

COMMENT
Define merchantable species and sizes for Klamath Mountains (KM) variant.
VOLUME for cubic foot (pulp), BFVOLUME for boardfoot (sawlogs).  
END
VOLUME             0       All       999       999
VOLUME             0        DF       3.2         2
VOLUME             0        BM       3.2         2
VOLUME             0        RA       3.2         2
VOLUME             0        BO       3.2         2
VOLUME             0        CW       3.2         2
VOLUME             0        FL       3.2         2
VOLUME             0        GC       3.2         2
VOLUME             0        MA       3.2         2
VOLUME             0        TO       3.2         2
VOLUME             0        WN       3.2         2
VOLUME             0        WO       3.2         2
VOLUME             0        WF       3.2         2
VOLUME             0        WH       3.2         2
VOLUME             0        RF       3.2         2
VOLUME             0        SH       3.2         2
BFVOLUME           0       All       999       999
BFVOLUME           0        IC       6.2         5
BFVOLUME           0        PC       6.2         5
BFVOLUME           0        BM       5.7         5
BFVOLUME           0        RA       5.7         5
BFVOLUME           0        LP       6.2         5
BFVOLUME           0        PY       6.2         5
BFVOLUME           0        RC       6.2         5
BFVOLUME           0        WP       6.2         5
BFVOLUME           0        BO       5.7         5
BFVOLUME           0        CW       5.7         5
BFVOLUME           0        FL       5.7         5
BFVOLUME           0        GC       5.7         5
BFVOLUME           0        MA       5.7         5
BFVOLUME           0        TO       5.7         5
BFVOLUME           0        WN       5.7         5
BFVOLUME           0        WO       5.7         5
BFVOLUME           0        JP       6.2         5
BFVOLUME           0        PP       6.2         5
BFVOLUME           0        SP       6.2         5
BFVOLUME           0        WJ        10         6
BFVOLUME           0        WF       6.2         5
BFVOLUME           0        WH       6.2         5

COMMENT
ECON extension used to calculate total boardfoot and cubic foot
volumes harvested for each merchantable species.  Suitable for 
calculating pulp and "camp run" sawlog revenues.
END
ECON
STRTECON           1  
HRVRVN             0         2
HRVRVN             0         3
END

COMMENT
ECON extension used to break harvest volumes into sawlog grades.
Uses sawlog grades defined in Official Log Scaling Rules (Jan 2011).
END
SPGROUP       WHTYPE
WH WF
SPGROUP       PPTYPE
PP SP IC JP
SPGROUP       WPTYPE
WP LP
SPGROUP       RATYPE
RA BM CW FL GC MA TO WN WO PY
ECON
HRVRVN             0         4         5        DF
HRVRVN             0         4         6        DF
HRVRVN             0         4        12        DF
HRVRVN             0         4        30        DF
HRVRVN             0         4         5        PC
HRVRVN             0         4         6        PC
HRVRVN             0         4        12        PC
HRVRVN             0         4        30        PC
HRVRVN             0         4         5        RC
HRVRVN             0         4         6        RC
HRVRVN             0         4        20        RC
HRVRVN             0         4        28        RC
HRVRVN             0         4         5    WHTYPE
HRVRVN             0         4         6    WHTYPE
HRVRVN             0         4        12    WHTYPE
HRVRVN             0         4        24    WHTYPE
HRVRVN             0         4         5    PPTYPE
HRVRVN             0         4         6    PPTYPE
HRVRVN             0         4        12    PPTYPE
HRVRVN             0         4        24    PPTYPE
HRVRVN             0         4        30    PPTYPE
HRVRVN             0         4         5    WPTYPE
HRVRVN             0         4         6    WPTYPE
HRVRVN             0         4        12    WPTYPE
HRVRVN             0         4        20    WPTYPE
HRVRVN             0         4        24    WPTYPE
HRVRVN             0         4         5    RATYPE
HRVRVN             0         4        10    RATYPE
HRVRVN             0         4        12    RATYPE
HRVRVN             0         4        16    RATYPE
END

COMMENT
Compute harvested boardfoot volumes by species groups.
END
COMPUTE            0
CEDR_HRV = 0+SPMCDBH(4,IC,0,0,999,0,999,2)+SPMCDBH(4,PC,0,0,999,0,999,2)
DF_HRV = 0+SPMCDBH(4,DF,0,0,999,0,999,2)
HW_HRV = 0+SPMCDBH(4,RA,0,0,999,0,999,2)+SPMCDBH(4,BM,0,0,999,0,999,2)
MNCONHRV = 0+SPMCDBH(4,LP,0,0,999,0,999,2)+SPMCDBH(4,PY,0,0,999,0,999,2)&
+SPMCDBH(4,RC,0,0,999,0,999,2)+SPMCDBH(4,WP,0,0,999,0,999,2)
MNHW_HRV = 0+SPMCDBH(4,BO,0,0,999,0,999,2)+SPMCDBH(4,CW,0,0,999,0,999,2)&
+SPMCDBH(4,FL,0,0,999,0,999,2)+SPMCDBH(4,GC,0,0,999,0,999,2)&
+SPMCDBH(4,MA,0,0,999,0,999,2)+SPMCDBH(4,TO,0,0,999,0,999,2)&
+SPMCDBH(4,WN,0,0,999,0,999,2)+SPMCDBH(4,WO,0,0,999,0,999,2)
PINE_HRV = 0+SPMCDBH(4,JP,0,0,999,0,999,2)+SPMCDBH(4,PP,0,0,999,0,999,2)&
+SPMCDBH(4,SP,0,0,999,0,999,2)
SPRC_HRV = 0
WJ_HRV = 0+SPMCDBH(4,WJ,0,0,999,0,999,2)
WW_HRV = 0+SPMCDBH(4,WH,0,0,999,0,999,2)+SPMCDBH(4,WF,0,0,999,0,999,2)
END

COMMENT
Compute standing boardfoot volumes by species groups.
END
COMPUTE            0
CEDR_BF = 0+SPMCDBH(4,IC,0,0,999,0,999,3)+SPMCDBH(4,PC,0,0,999,0,999,3)
DF_BF = 0+SPMCDBH(4,DF,0,0,999,0,999,3)
HW_BF = 0+SPMCDBH(4,RA,0,0,999,0,999,3)+SPMCDBH(4,BM,0,0,999,0,999,3)
MNCONBF = 0+SPMCDBH(4,LP,0,0,999,0,999,3)+SPMCDBH(4,PY,0,0,999,0,999,3)&
+SPMCDBH(4,RC,0,0,999,0,999,3)+SPMCDBH(4,WP,0,0,999,0,999,3)
MNHW_BF = 0+SPMCDBH(4,BO,0,0,999,0,999,3)+SPMCDBH(4,CW,0,0,999,0,999,3)&
+SPMCDBH(4,FL,0,0,999,0,999,3)+SPMCDBH(4,GC,0,0,999,0,999,3)&
+SPMCDBH(4,MA,0,0,999,0,999,3)+SPMCDBH(4,TO,0,0,999,0,999,3)&
+SPMCDBH(4,WN,0,0,999,0,999,3)+SPMCDBH(4,WO,0,0,999,0,999,3)
PINE_BF = 0+SPMCDBH(4,JP,0,0,999,0,999,3)+SPMCDBH(4,PP,0,0,999,0,999,3)&
+SPMCDBH(4,SP,0,0,999,0,999,3)
SPRC_BF = 0
WJ_BF = 0+SPMCDBH(4,WJ,0,0,999,0,999,3)
WW_BF = 0+SPMCDBH(4,WH,0,0,999,0,999,3)+SPMCDBH(4,WF,0,0,999,0,999,3)
END

COMMENT
Compute fire hazard rating based on Hugget, Abt, and Shepperd (2008):
0 = very low risk
1 = low risk
2 = medium risk
3 = medium-high risk
4 = high risk
END
IF
EVPHASE EQ 2
THEN
AGPLABEL
All
COMPUTE            0
FIREHZD = BOUND(0,LININT(TORCHIDX,25,25,2,0) + &
LININT(CROWNIDX,25,25,40,40,3,0,0,-1),4)
END
ENDIF

COMMENT
Create Carbon Reports with units of metric tonnes C per acre.
END
FMIN
CARBREPT                               5
CARBCUT                                5   
CARBCALC           0         2
END

COMMENT
Turn off diameter and height growth calibration and dwarf mistletoe components.
END
NOCALIB
MISTOE
MISTOFF
END


COMMENT
Define conifers as a species group.  CA variant.
END
SPGROUP       CONSPP
BR CP DF GP GS IC JP KP LM LP MH MP OS PC PP PY RC RF SH SP WB WF WH WJ WP

COMMENT
Compute variables used as inputs for cost model.  Variables provide average
cubic foot volume of harvested trees ("CF" at end of name), number of trees
per acre harvested ("TPA" at end of name), and proportion of harvested volume
coming from hardwoods ("HW" at end of name) in diameter classes 2"<CH<5"
5"<SM<20" and LG>=20" (CH, SM, LG at beginning of name).
END
COMPUTE            0
CH_TPA = SPMCDBH(1,All,0,2,5,0,999,2)
SM_TPA = SPMCDBH(1,All,0,5,20,0,999,2)
LG_TPA = SPMCDBH(1,All,0,20,999,0,999,2)
END
IF
SPMCDBH(1,All,0,2,5,0,999,2) EQ 0
THEN
AGPLABEL
All
COMPUTE            0
CH_CF = 0
CH_HW = 0
END
ENDIF
IF
SPMCDBH(1,All,0,5,20,0,999,2) EQ 0
THEN
AGPLABEL
All
COMPUTE            0
SM_CF = 0
SM_HW = 0
END
ENDIF
IF
SPMCDBH(1,All,0,20,999,0,999,2) EQ 0
THEN
AGPLABEL
All
COMPUTE            0
LG_CF = 0
LG_HW = 0
END
ENDIF
IF
SPMCDBH(1,All,0,2,5,0,999,2) GT 0
THEN
AGPLABEL
All
COMPUTE            0
CH_CF = SPMCDBH(3,All,0,2,5,0,999,2)/SPMCDBH(1,All,0,2,5,0,999,2)
CH_HW = 1-(SPMCDBH(3,CONSPP,0,2,5,0,999,2)/SPMCDBH(3,All,0,2,5,0,999,2))
END
ENDIF
IF
SPMCDBH(1,All,0,5,20,0,999,2) GT 0
THEN
AGPLABEL
All
COMPUTE            0
SM_CF = SPMCDBH(3,All,0,5,20,0,999,2)/SPMCDBH(1,All,0,5,20,0,999,2)
SM_HW = 1-(SPMCDBH(3,CONSPP,0,5,20,0,999,2)/SPMCDBH(3,All,0,5,20,0,999,2))
END
ENDIF
IF
SPMCDBH(1,All,0,20,999,0,999,2) GT 0
THEN
AGPLABEL
All
COMPUTE            0
LG_CF = SPMCDBH(3,All,0,20,999,0,999,2)/SPMCDBH(1,All,0,20,999,0,999,2)
LG_HW = 1-(SPMCDBH(3,CONSPP,0,20,999,0,999,2)/SPMCDBH(3,All,0,20,999,0,999,2))
END
ENDIF

COMMENT
Compute variables used in Northern spotted owl suitability rating.
Diameter Diversity Index from McComb, McGrath, Spies, and Vesely (2000) 
and Franklin, Spies, and Van Pelt (2005).  Other variables defined by
2011 Revised Recovery Plan for NSO, converted to English units.
END
IF
EVPHASE EQ 2
THEN
AGPLABEL
All
COMPUTE            0
DDI = LININT(SPMCDBH(1,All,0,2,9.8),0,81,0,1) + &
2*LININT(SPMCDBH(1,All,0,9.8,19.7),0,30,0,1) + &
3*LININT(SPMCDBH(1,All,0,19.7,39.4),0,16,0,1) + &
4*LININT(SPMCDBH(1,All,0,39.4),0,12,0,1)
CANCOV_C = SPMCDBH(7,CONSPP,0)
QMDC_DOM = SPMCDBH(5,CONSPP,0,ASTRDBH,999)
TPAGE19 = SPMCDBH(1,All,0,19.7)
BACGE1 = SPMCDBH(2,CONSPP,0,1.2)
END
ENDIF
IF
EVPHASE EQ 2 AND SPMCDBH(2,All,0,1.2) GT 0
THEN
AGPLABEL
All
COMPUTE            0
BAHPROP = 1-(SPMCDBH(2,CONSPP,0,1.2)/SPMCDBH(2,All,0,1.2))
END
ENDIF
IF
EVPHASE EQ 2 AND SPMCDBH(2,All,0,1.2) EQ 0
THEN
AGPLABEL
All
COMPUTE            0
BAHPROP = 0
END
ENDIF

COMMENT
Compute Suitability for Northern Spotted Owl.  Includes ratings for 
Nesting/Roosting (NSONEST), Foraging (NSOFRG), and Dispersal (NSODIS).
Stands are rated suitable if they satisfy Klamath Mountains Western OR
Klamath Mountains Eastern thresholds from 2011 Revised NSO Recovery Plan. 
Ratings for NSONEST, NSOFRG, and NSODIS:
0 = not suitable
1 = suitable
END
IF
EVPHASE EQ 2
THEN
AGPLABEL
All
COMPUTE            0
NSONESTW = LININT(LININT(ACANCOV,75,75,0,1)+LININT(DDI,6,6,0,1)&
+LININT(QMDC_DOM,19.7,19.7,0,1),3,3,0,1)
NSONESTE = LININT(LININT(ACANCOV,65,65,0,1)+LININT(DDI,5.5,5.5,0,1)&
+LININT(QMDC_DOM,16.5,16.5,0,1),3,3,0,1)
NSONEST = LININT(NSONESTW+NSONESTE,1,1,0,1)
NSOFRGW = LININT(LININT(DDI,4,4,0,1)+LININT(BACGE1,78,78,0,1)&
+LININT(BAHPROP,0.25,0.25,0.7,0.7,0,1,1,0),3,3,0,1)
NSOFRGE = LININT(LININT(CANCOV_C,45,45,0,1)+&
LININT(TPAGE19,9.3,9.3,0,1)+LININT(QMDC_DOM,11.8,11.8,0,1),3,3,0,1)
NSOFRG = LININT(NSOFRGW+NSOFRGE+NSONEST,1,1,0,1)
NSODIS = LININT(LININT(LININT(SPMCDBH(5,All,0),11,11,0,1)&
+LININT(CANCOV_C,30,30,0,1),2,2,0,1)+NSOFRG+NSONEST,1,1,0,1)
END
ENDIF

COMMENT
Compute susceptibility ratings for Mountain Pine Beetle in Ponderosa Pine
(PP_BTL) and Lodgepole Pine (LP_BTL). Ratings for PP_BTL, based on Munson
and Anhold (1995) and described in User's Guide to the Post-Processors 
for the Forest Vegetation Simulator (Van Dyck 2005):
3-4  = Low
5-8  = Moderate
9-11 = High
Ratings for LP_BTL, based on Randall and Tensmeyer (2000):
1    = Extremely low
2-7  = Low
8-13 = Moderate
14   = High
END
IF
EVPHASE EQ 2
THEN
AGPLABEL
All
COMPUTE            0
PP_BTL = LININT(SPMCDBH(5,PP,0,5,999),6,6,12,12,1,2,2,3) + &
LININT(SPMCDBH(2,All,0,5,999),80,80,120,120,1,2,2,3) + &
LININT(SPMCDBH(1,PP,0,0,999,0.75*ATOPHT,999)/&
SPMCDBH(1,All,0,0,999,0.75*ATOPHT,999),0.5,0.5,0.65,0.65,1,2,2,3)
LP_BTL = MIN(LININT(SPMCDBH(2,LP,0)/SPMCDBH(2,All,0),0.0001,0.0001,&
.25,.25,.5,.5,1,2,2,8,8,14),LININT(ABA,80,80,120,120,250,250,3,9,9,&
14,14,3),LININT(SPMCDBH(1,All,0,3),100,100,300,300,600,600,800,800,&
4,10,10,14,14,10,10,4),LININT(SPMCDBH(5,LP,0,5),6,6,8,8,5,11,11,14)&
,LININT(Age,60,80,7,13,13,14))
END
ENDIF

COMMENT
Species diversity metrics for the CA variant.  
SPPRICH is species richness (# of species)
SPPSIMP is inverse Simpson index based on trees per acre
END
IF 
EVPHASE EQ 2
THEN
AGPLABEL
All
COMPUTE            0
SPPRICHA = 0+LININT(SPMCDBH(1,1,0),0.01,0.01,0,1)&
+LININT(SPMCDBH(1,2,0),0.01,0.01,0,1)+LININT(SPMCDBH(1,3,0),0.01,0.01,0,1)&
+LININT(SPMCDBH(1,4,0),0.01,0.01,0,1)+LININT(SPMCDBH(1,5,0),0.01,0.01,0,1)&
+LININT(SPMCDBH(1,6,0),0.01,0.01,0,1)+LININT(SPMCDBH(1,7,0),0.01,0.01,0,1)&
+LININT(SPMCDBH(1,8,0),0.01,0.01,0,1)+LININT(SPMCDBH(1,9,0),0.01,0.01,0,1)&
+LININT(SPMCDBH(1,10,0),0.01,0.01,0,1)+LININT(SPMCDBH(1,11,0),0.01,0.01,0,1)&
+LININT(SPMCDBH(1,12,0),0.01,0.01,0,1)+LININT(SPMCDBH(1,13,0),0.01,0.01,0,1)&
+LININT(SPMCDBH(1,14,0),0.01,0.01,0,1)+LININT(SPMCDBH(1,15,0),0.01,0.01,0,1)&
+LININT(SPMCDBH(1,16,0),0.01,0.01,0,1)+LININT(SPMCDBH(1,17,0),0.01,0.01,0,1)&
+LININT(SPMCDBH(1,18,0),0.01,0.01,0,1)+LININT(SPMCDBH(1,19,0),0.01,0.01,0,1)&
+LININT(SPMCDBH(1,20,0),0.01,0.01,0,1)
SPPRICHB = 0+LININT(SPMCDBH(1,21,0),0.01,0.01,0,1)&
+LININT(SPMCDBH(1,22,0),0.01,0.01,0,1)+LININT(SPMCDBH(1,23,0),0.01,0.01,0,1)&
+LININT(SPMCDBH(1,24,0),0.01,0.01,0,1)+LININT(SPMCDBH(1,25,0),0.01,0.01,0,1)&
+LININT(SPMCDBH(1,26,0),0.01,0.01,0,1)+LININT(SPMCDBH(1,27,0),0.01,0.01,0,1)&
+LININT(SPMCDBH(1,28,0),0.01,0.01,0,1)+LININT(SPMCDBH(1,29,0),0.01,0.01,0,1)&
+LININT(SPMCDBH(1,30,0),0.01,0.01,0,1)+LININT(SPMCDBH(1,31,0),0.01,0.01,0,1)&
+LININT(SPMCDBH(1,32,0),0.01,0.01,0,1)+LININT(SPMCDBH(1,33,0),0.01,0.01,0,1)&
+LININT(SPMCDBH(1,34,0),0.01,0.01,0,1)+LININT(SPMCDBH(1,35,0),0.01,0.01,0,1)&
+LININT(SPMCDBH(1,36,0),0.01,0.01,0,1)+LININT(SPMCDBH(1,37,0),0.01,0.01,0,1)&
+LININT(SPMCDBH(1,38,0),0.01,0.01,0,1)+LININT(SPMCDBH(1,39,0),0.01,0.01,0,1)
SPPRICHC = 0+LININT(SPMCDBH(1,40,0),0.01,0.01,0,1)&
+LININT(SPMCDBH(1,41,0),0.01,0.01,0,1)&
+LININT(SPMCDBH(1,42,0),0.01,0.01,0,1)+LININT(SPMCDBH(1,43,0),0.01,0.01,0,1)&
+LININT(SPMCDBH(1,44,0),0.01,0.01,0,1)+LININT(SPMCDBH(1,45,0),0.01,0.01,0,1)&
+LININT(SPMCDBH(1,46,0),0.01,0.01,0,1)+LININT(SPMCDBH(1,47,0),0.01,0.01,0,1)&
+LININT(SPMCDBH(1,48,0),0.01,0.01,0,1)+LININT(SPMCDBH(1,49,0),0.01,0.01,0,1)
SPPRICH = SPPRICHA + SPPRICHB + SPPRICHC
SPPSIMPA = 0+(SPMCDBH(1,1,0)/SPMCDBH(1,0,0))**2&
+(SPMCDBH(1,2,0)/SPMCDBH(1,0,0))**2+(SPMCDBH(1,3,0)/SPMCDBH(1,0,0))**2&
+(SPMCDBH(1,4,0)/SPMCDBH(1,0,0))**2+(SPMCDBH(1,5,0)/SPMCDBH(1,0,0))**2&
+(SPMCDBH(1,6,0)/SPMCDBH(1,0,0))**2+(SPMCDBH(1,7,0)/SPMCDBH(1,0,0))**2&
+(SPMCDBH(1,8,0)/SPMCDBH(1,0,0))**2+(SPMCDBH(1,9,0)/SPMCDBH(1,0,0))**2&
+(SPMCDBH(1,10,0)/SPMCDBH(1,0,0))**2+(SPMCDBH(1,11,0)/SPMCDBH(1,0,0))**2&
+(SPMCDBH(1,12,0)/SPMCDBH(1,0,0))**2+(SPMCDBH(1,13,0)/SPMCDBH(1,0,0))**2&
+(SPMCDBH(1,14,0)/SPMCDBH(1,0,0))**2+(SPMCDBH(1,15,0)/SPMCDBH(1,0,0))**2&
+(SPMCDBH(1,16,0)/SPMCDBH(1,0,0))**2+(SPMCDBH(1,17,0)/SPMCDBH(1,0,0))**2&
+(SPMCDBH(1,18,0)/SPMCDBH(1,0,0))**2+(SPMCDBH(1,19,0)/SPMCDBH(1,0,0))**2
SPPSIMPB = 0+(SPMCDBH(1,20,0)/SPMCDBH(1,0,0))**2&
+(SPMCDBH(1,21,0)/SPMCDBH(1,0,0))**2&
+(SPMCDBH(1,22,0)/SPMCDBH(1,0,0))**2+(SPMCDBH(1,23,0)/SPMCDBH(1,0,0))**2&
+(SPMCDBH(1,24,0)/SPMCDBH(1,0,0))**2+(SPMCDBH(1,25,0)/SPMCDBH(1,0,0))**2&
+(SPMCDBH(1,26,0)/SPMCDBH(1,0,0))**2+(SPMCDBH(1,27,0)/SPMCDBH(1,0,0))**2&
+(SPMCDBH(1,28,0)/SPMCDBH(1,0,0))**2+(SPMCDBH(1,29,0)/SPMCDBH(1,0,0))**2&
+(SPMCDBH(1,30,0)/SPMCDBH(1,0,0))**2+(SPMCDBH(1,31,0)/SPMCDBH(1,0,0))**2&
+(SPMCDBH(1,32,0)/SPMCDBH(1,0,0))**2+(SPMCDBH(1,33,0)/SPMCDBH(1,0,0))**2&
+(SPMCDBH(1,34,0)/SPMCDBH(1,0,0))**2+(SPMCDBH(1,35,0)/SPMCDBH(1,0,0))**2&
+(SPMCDBH(1,36,0)/SPMCDBH(1,0,0))**2+(SPMCDBH(1,37,0)/SPMCDBH(1,0,0))**2&
+(SPMCDBH(1,38,0)/SPMCDBH(1,0,0))**2+(SPMCDBH(1,39,0)/SPMCDBH(1,0,0))**2&
+(SPMCDBH(1,40,0)/SPMCDBH(1,0,0))**2
SPPSIMPC = 0+(SPMCDBH(1,41,0)/SPMCDBH(1,0,0))**2&
+(SPMCDBH(1,42,0)/SPMCDBH(1,0,0))**2+(SPMCDBH(1,43,0)/SPMCDBH(1,0,0))**2&
+(SPMCDBH(1,44,0)/SPMCDBH(1,0,0))**2+(SPMCDBH(1,45,0)/SPMCDBH(1,0,0))**2&
+(SPMCDBH(1,46,0)/SPMCDBH(1,0,0))**2+(SPMCDBH(1,47,0)/SPMCDBH(1,0,0))**2&
+(SPMCDBH(1,48,0)/SPMCDBH(1,0,0))**2+(SPMCDBH(1,49,0)/SPMCDBH(1,0,0))**2
SPPSIMP = 1/(SPPSIMPA + SPPSIMPB + SPPSIMPC)
END
ENDIF

COMMENT
Preferentially remove WJ in any cutting, only applies to thin from below,
or thin from above.  Does not apply when thinning throughout a diameter
distribution.
END
SPECPREF           1        WJ        50

COMMENT
Simulate thin from below every 10 years after age 30 to achieve complex uneven-age
forest structure.  Reverse J-shape diameter distribution targeting 65% maximum SDI.
Pile and burn slash after harvesting.  Adapted from script by Don Vandendriesche.
END
IF                10
AGE GE 30 AND YEAR GE REGENYR
THEN
AGPLABEL
All
*   Definition of Compute Variables:
*    _SDI = Target Stand Density Index
*      _Q = Q-Factor
*     _DB = Minimum Diameter Class
*     _DE = Maximum Diameter Class
*     _DI = Diameter Class Interval
*    _LLT = Number of Legacy Trees
*    _LLD = Diameter of Legacy Trees
*      _C = 0.00545415 (BA conversion constant)
*      _E = 1.605 SDI Exponent
COMPUTE            1
_SDI=0.55*BSDIMAX
_Q  =1.4
_DB =0
_DE =25
_DI =5
_LLT=12.
_LLD=40.
_C  =0.00545415
_E  =1.605
END
ENDIF

* Compute Actual SDI, DBH Classes, Trial TPA, and Trial SDI/DBH CLASS
IF                 10
AGE GE 30 AND YEAR GE REGENYR
THEN
AGPLABEL
All
COMPUTE            0
_X20=((LININT(LININT &
     (MAX((_DE-(_DI*00)),0),(_DB-_DI)+((_DB-_DI)/1000), &
     (_DB-_DI)+((_DB-_DI)/1000),0,1),1,1,0, &
     MAX((LININT(_DE-(_DI*00),0,0,_DE-(_DI*00),MAX(_DE-(_DI*00),_DB/2)),0)))) &
     /10)**_E*_Q**00
_X19=((LININT(LININT &
     (MAX((_DE-(_DI*01)),0),(_DB-_DI)+((_DB-_DI)/1000), &
     (_DB-_DI)+((_DB-_DI)/1000),0,1),1,1,0, &
     MAX((LININT(_DE-(_DI*01),0,0,_DE-(_DI*01),MAX(_DE-(_DI*01),_DB/2)),0)))) &
     /10)**_E*_Q**01
_X18=((LININT(LININT &
     (MAX((_DE-(_DI*02)),0),(_DB-_DI)+((_DB-_DI)/1000), &
     (_DB-_DI)+((_DB-_DI)/1000),0,1),1,1,0, &
     MAX((LININT(_DE-(_DI*02),0,0,_DE-(_DI*02),MAX(_DE-(_DI*02),_DB/2)),0)))) &
     /10)**_E*_Q**02
_X17=((LININT(LININT &
     (MAX((_DE-(_DI*03)),0),(_DB-_DI)+((_DB-_DI)/1000), &
     (_DB-_DI)+((_DB-_DI)/1000),0,1),1,1,0, &
     MAX((LININT(_DE-(_DI*03),0,0,_DE-(_DI*03),MAX(_DE-(_DI*03),_DB/2)),0)))) &
     /10)**_E*_Q**03
_X16=((LININT(LININT &
     (MAX((_DE-(_DI*04)),0),(_DB-_DI)+((_DB-_DI)/1000), &
     (_DB-_DI)+((_DB-_DI)/1000),0,1),1,1,0, &
     MAX((LININT(_DE-(_DI*04),0,0,_DE-(_DI*04),MAX(_DE-(_DI*04),_DB/2)),0)))) &
     /10)**_E*_Q**04
_T20=LININT(LININT(_X20,0.001,0.001,0,1),1,1,0, &
     (MAX((SpMcDBH(1,All,0,LININT(MAX((_DE-(_DI*00))-_DI/2,0), &
      _DI,_DI,0.001,MAX((_DE-(_DI*00))-_DI/2,0)), &
      MAX((_DE-(_DI*00))+_DI/2,0),0.0,999.0,0)),0)))
_T19=LININT(LININT(_X19,0.001,0.001,0,1),1,1,0, &
     (MAX((SpMcDBH(1,All,0,LININT(MAX((_DE-(_DI*01))-_DI/2,0), &
      _DI,_DI,0.001,MAX((_DE-(_DI*01))-_DI/2,0)), &
      MAX((_DE-(_DI*01))+_DI/2,0),0.0,999.0,0)),0)))
_T18=LININT(LININT(_X18,0.001,0.001,0,1),1,1,0, &
     (MAX((SpMcDBH(1,All,0,LININT(MAX((_DE-(_DI*02))-_DI/2,0), &
      _DI,_DI,0.001,MAX((_DE-(_DI*02))-_DI/2,0)), &
      MAX((_DE-(_DI*02))+_DI/2,0),0.0,999.0,0)),0)))
_T17=LININT(LININT(_X17,0.001,0.001,0,1),1,1,0, &
     (MAX((SpMcDBH(1,All,0,LININT(MAX((_DE-(_DI*03))-_DI/2,0), &
      _DI,_DI,0.001,MAX((_DE-(_DI*03))-_DI/2,0)), &
      MAX((_DE-(_DI*03))+_DI/2,0),0.0,999.0,0)),0)))
_T16=LININT(LININT(_X16,0.001,0.001,0,1),1,1,0, &
     (MAX((SpMcDBH(1,All,0,LININT(MAX((_DE-(_DI*04))-_DI/2,0), &
      _DI,_DI,0.001,MAX((_DE-(_DI*04))-_DI/2,0)), &
      MAX((_DE-(_DI*04))+_DI/2,0),0.0,999.0,0)),0)))
_S20=_T20*((LININT(LININT(_X20,0.001,0.001,0,1),1,1,0, &
     (MAX((SpMcDBH(5,All,0,LININT(MAX((_DE-(_DI*00))-_DI/2,0), &
      _DI,_DI,0.001,MAX((_DE-(_DI*00))-_DI/2,0)), &
      MAX((_DE-(_DI*00))+_DI/2,0),0.0,999.0,0)),0)))/10)**_E)
_S19=_T19*((LININT(LININT(_X19,0.001,0.001,0,1),1,1,0, &
     (MAX((SpMcDBH(5,All,0,LININT(MAX((_DE-(_DI*01))-_DI/2,0), &
      _DI,_DI,0.001,MAX((_DE-(_DI*01))-_DI/2,0)), &
      MAX((_DE-(_DI*01))+_DI/2,0),0.0,999.0,0)),0)))/10)**_E)
_S18=_T18*((LININT(LININT(_X18,0.001,0.001,0,1),1,1,0, &
     (MAX((SpMcDBH(5,All,0,LININT(MAX((_DE-(_DI*02))-_DI/2,0), &
      _DI,_DI,0.001,MAX((_DE-(_DI*02))-_DI/2,0)), &
      MAX((_DE-(_DI*02))+_DI/2,0),0.0,999.0,0)),0)))/10)**_E)
_S17=_T17*((LININT(LININT(_X17,0.001,0.001,0,1),1,1,0, &
     (MAX((SpMcDBH(5,All,0,LININT(MAX((_DE-(_DI*03))-_DI/2,0), &
      _DI,_DI,0.001,MAX((_DE-(_DI*03))-_DI/2,0)), &
      MAX((_DE-(_DI*03))+_DI/2,0),0.0,999.0,0)),0)))/10)**_E)
_S16=_T16*((LININT(LININT(_X16,0.001,0.001,0,1),1,1,0, &
     (MAX((SpMcDBH(5,All,0,LININT(MAX((_DE-(_DI*04))-_DI/2,0), &
      _DI,_DI,0.001,MAX((_DE-(_DI*04))-_DI/2,0)), &
      MAX((_DE-(_DI*04))+_DI/2,0),0.0,999.0,0)),0)))/10)**_E)
_ASDI=_S20+_S19+_S18+_S17+_S16
END
ENDIF

* Compute Conversion Factor, Target SDI, and Excess SDI
IF                10
AGE GE 30 AND YEAR GE REGENYR AND _ASDI GE _SDI
THEN
AGPLABEL
All
COMPUTE            0
_CF=_SDI/(_X20+_X19+_X18+_X17+_X16)
_Y20=_X20*_CF
_Y19=_X19*_CF
_Y18=_X18*_CF
_Y17=_X17*_CF
_Y16=_X16*_CF
_TSDI=_Y20+_Y19+_Y18+_Y17+_Y16
_Z20=MAX(_S20-_Y20,0)
_Z19=MAX(_S19-_Y19,0)
_Z18=MAX(_S18-_Y18,0)
_Z17=MAX(_S17-_Y17,0)
_Z16=MAX(_S16-_Y16,0)
_ZSDI=(_ASDI-_TSDI) &
      /MAX(1,(_Z20+_Z19+_Z18+_Z17+_Z16))
_Y21=LININT(LININT(MAX(_ZSDI,0),0.001,0.001,0,1),0.001,0.001,_SDI- &
(SpMcDBH(11,All,0,_DB-(_DI/2),_DE+(_DI/2),0.0,999.0,0)-_LLT*((_LLD/10)**_E)), &
(_LLT*((_LLD/10)**_E)))
END
** Sets Thinning through all DBH Classes
ESTAB
NOSPROUT
END
* Legacy Trees
THINSDI            0   Parms(_Y21,1.00,All,(_DE+(MAX((_LLD-_DE),_DI))-_DI/2), &
(_DE+(MAX((_LLD-_DE),_DI))+_DI/2),2)
THINSDI            0   Parms(_Y21,1.00,All,(_DE+(_DI*01)-_DI/2),999.0,2)
* Managed DBH Classes
THINBTA            0   Parms(LININT(LININT(_Y20,0.001,0.001,0,1),1,1,999.0, &
(_Y20+(_Z20-_Z20*_ZSDI))/(MAX(_X20,0.000001)/_Q**00)),1.00, &
LININT(MAX((_DE-(_DI*00))-_DI/2,0), &
_DI,_DI,0.001,MAX((_DE-(_DI*00))-_DI/2,0)), &
MAX((_DE-(_DI*00))+_DI/2,0),0,999)
THINBTA            0   Parms(LININT(LININT(_Y19,0.001,0.001,0,1),1,1,999.0, &
(_Y19+(_Z19-_Z19*_ZSDI))/(MAX(_X19,0.000001)/_Q**01)),1.00, &
LININT(MAX((_DE-(_DI*01))-_DI/2,0), &
_DI,_DI,0.001,MAX((_DE-(_DI*01))-_DI/2,0)), &
MAX((_DE-(_DI*01))+_DI/2,0),0,999)
THINBTA            0   Parms(LININT(LININT(_Y18,0.001,0.001,0,1),1,1,999.0, &
(_Y18+(_Z18-_Z18*_ZSDI))/(MAX(_X18,0.000001)/_Q**02)),1.00, &
LININT(MAX((_DE-(_DI*02))-_DI/2,0), &
_DI,_DI,0.001,MAX((_DE-(_DI*02))-_DI/2,0)), &
MAX((_DE-(_DI*02))+_DI/2,0),0,999)
THINBTA            0   Parms(LININT(LININT(_Y17,0.001,0.001,0,1),1,1,999.0, &
(_Y17+(_Z17-_Z17*_ZSDI))/(MAX(_X17,0.000001)/_Q**03)),1.00, &
LININT(MAX((_DE-(_DI*03))-_DI/2,0), &
_DI,_DI,0.001,MAX((_DE-(_DI*03))-_DI/2,0)), &
MAX((_DE-(_DI*03))+_DI/2,0),0,999)
THINBTA            0   Parms(LININT(LININT(_Y16,0.001,0.001,0,1),1,1,999.0, &
(_Y16+(_Z16-_Z16*_ZSDI))/(MAX(_X16,0.000001)/_Q**04)),1.00, &
LININT(MAX((_DE-(_DI*04))-_DI/2,0), &
_DI,_DI,0.001,MAX((_DE-(_DI*04))-_DI/2,0)), &
MAX((_DE-(_DI*04))+_DI/2,0),0,999)
FMIN
FUELTRET           0         1
END
ENDIF

COMMENT
Trigger natural regeneration when >10% of canopy removed or when SDI falls
below 25% of maximum SDI.
Regeneration based on pre-cut TPA >5" by species. CA Variant.
END
IF                20
(ACANCOV)/(BCANCOV)*(100) LT 90 OR ASDI LE (0.25*BSDIMAX)
THEN
AGPLABEL
All
ESTAB
NATURAL            1    Parms(PC, SPMCDBH(1,PC,0,5,999) +&
SPMCDBH(1,PC,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(IC, SPMCDBH(1,IC,0,5,999) +&
SPMCDBH(1,IC,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(RC, SPMCDBH(1,RC,0,5,999) +&
SPMCDBH(1,RC,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(WF, SPMCDBH(1,WF,0,5,999) +&
SPMCDBH(1,WF,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(RF, SPMCDBH(1,RF,0,5,999) +&
SPMCDBH(1,RF,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(SH, SPMCDBH(1,SH,0,5,999) +&
SPMCDBH(1,SH,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(DF, SPMCDBH(1,DF,0,5,999) +&
SPMCDBH(1,DF,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(WH, SPMCDBH(1,WH,0,5,999) +&
SPMCDBH(1,WH,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(MH, SPMCDBH(1,MH,0,5,999) +&
SPMCDBH(1,MH,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(WB, SPMCDBH(1,WB,0,5,999) +&
SPMCDBH(1,WB,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(KP, SPMCDBH(1,KP,0,5,999) +&
SPMCDBH(1,KP,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(LP, SPMCDBH(1,LP,0,5,999) +&
SPMCDBH(1,LP,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(CP, SPMCDBH(1,CP,0,5,999) +&
SPMCDBH(1,CP,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(LM, SPMCDBH(1,LM,0,5,999) +&
SPMCDBH(1,LM,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(JP, SPMCDBH(1,JP,0,5,999) +&
SPMCDBH(1,JP,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(SP, SPMCDBH(1,SP,0,5,999) +&
SPMCDBH(1,SP,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(WP, SPMCDBH(1,WP,0,5,999) +&
SPMCDBH(1,WP,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(PP, SPMCDBH(1,PP,0,5,999) +&
SPMCDBH(1,PP,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(MP, SPMCDBH(1,MP,0,5,999) +&
SPMCDBH(1,MP,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(GP, SPMCDBH(1,GP,0,5,999) +&
SPMCDBH(1,GP,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(WJ, SPMCDBH(1,WJ,0,5,999) +&
SPMCDBH(1,WJ,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(BR, SPMCDBH(1,BR,0,5,999) +&
SPMCDBH(1,BR,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(GS, SPMCDBH(1,GS,0,5,999) +&
SPMCDBH(1,GS,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(PY, SPMCDBH(1,PY,0,5,999) +&
SPMCDBH(1,PY,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(OS, SPMCDBH(1,OS,0,5,999) +&
SPMCDBH(1,OS,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(LO, SPMCDBH(1,LO,0,5,999) +&
SPMCDBH(1,LO,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(CY, SPMCDBH(1,CY,0,5,999) +&
SPMCDBH(1,CY,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(BL, SPMCDBH(1,BL,0,5,999) +&
SPMCDBH(1,BL,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(EO, SPMCDBH(1,EO,0,5,999) +&
SPMCDBH(1,EO,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(WO, SPMCDBH(1,WO,0,5,999) +&
SPMCDBH(1,WO,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(BO, SPMCDBH(1,BO,0,5,999) +&
SPMCDBH(1,BO,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(VO, SPMCDBH(1,VO,0,5,999) +&
SPMCDBH(1,VO,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(IO, SPMCDBH(1,IO,0,5,999) +&
SPMCDBH(1,IO,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(BM, SPMCDBH(1,BM,0,5,999) +&
SPMCDBH(1,BM,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(BU, SPMCDBH(1,BU,0,5,999) +&
SPMCDBH(1,BU,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(RA, SPMCDBH(1,RA,0,5,999) +&
SPMCDBH(1,RA,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(MA, SPMCDBH(1,MA,0,5,999) +&
SPMCDBH(1,MA,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(GC, SPMCDBH(1,GC,0,5,999) +&
SPMCDBH(1,GC,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(DG, SPMCDBH(1,DG,0,5,999) +&
SPMCDBH(1,DG,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(FL, SPMCDBH(1,FL,0,5,999) +&
SPMCDBH(1,FL,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(WN, SPMCDBH(1,WN,0,5,999) +&
SPMCDBH(1,WN,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(TO, SPMCDBH(1,TO,0,5,999) +&
SPMCDBH(1,TO,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(SY, SPMCDBH(1,SY,0,5,999) +&
SPMCDBH(1,SY,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(AS, SPMCDBH(1,AS,0,5,999) +&
SPMCDBH(1,AS,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(CW, SPMCDBH(1,CW,0,5,999) +&
SPMCDBH(1,CW,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(WI, SPMCDBH(1,WI,0,5,999) +&
SPMCDBH(1,WI,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(CN, SPMCDBH(1,CN,0,5,999) +&
SPMCDBH(1,CN,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(CL, SPMCDBH(1,CL,0,5,999) +&
SPMCDBH(1,CL,0,5,999,0,999,2), 100., 2., 0.5, 0)
NATURAL            1    Parms(OH, SPMCDBH(1,OH,0,5,999) +&
SPMCDBH(1,OH,0,5,999,0,999,2), 100., 2., 0.5, 0)
END
ENDIF

PROCESS
CLOSE             50
STOP