{% extends 'common/base.html' %}
{% load url from future %}

{% if not user.is_authenticated %}
  {% block bodyclass %}no-auth{% endblock %}
{% endif %}  

{% block content %}
					
					<!-- Homepage is only for visitors not logged in.  -->
					{% if not user.is_authenticated %}
          
					<div class="row-fluid">
            <div id="home-html">


							<div>
								
								<div class="home-intro">
									<header class="hero">
										<h1>Forest Scenario Planner</h1>
										<h2>An online tool for forest management and scenario planning in Oregon and Washington</h2>
									</header>

                  <div style="display: table; margin: 0 auto;">
                    <img src="{{MEDIA_URL}}/img/screenshots/screen1.png" class="img-polaroid" style="height: 160px; margin: 12px;" />
                    <img src="{{MEDIA_URL}}/img/screenshots/screen2.png" class="img-polaroid" style="height: 160px; margin: 12px;" />
                    <img src="{{MEDIA_URL}}/img/screenshots/screen3.png" class="img-polaroid" style="height: 160px; margin: 12px;" />
                  </div>

									<div class="clearfix btn-bar">

                    <a class="btn btn-large btn-primary" href="/trees/about-the-forest-scenario-planner"> 
                      <span>Learn More </span>
											<span class="accessibility">about the Forest Scenario Planner</span> 
                      <!--<i class="icon-arrow-right icon-white"></i>-->
                    </a>
                    <a class="btn btn-large btn-success" href="{% url 'account_login' %}" id="signin">
											<!--<i class="icon-user icon-white"></i> -->
                      Get Started</a>	
									</div>

								</div>
							</div> 
							

            </div>
					</div>
					{% endif %}
					<!-- /End Home Page -->












            {% if user.is_authenticated %}
						<script>
							var authenticated = true;
						</script>
						<div class="row-fluid">

									<ul class="nav nav-tabs" id="global-tabs">
										<li data-bind="css: { active: app.state() == 'properties' }">
											<a data-bind="attr: { href: '#properties/' + app.selectedPropertyUID() }">
												<span class="tab-num">1</span>
												Properties<span style="display:none" data-bind="visible: app.selectedPropertyName() !== '' ">: </span>
												<span class="property-name" data-bind="text: app.selectedPropertyName()"></span>
											</a>
										</li>
										<li data-bind="css: { active: app.state() == 'stands'}">
											<a data-bind="attr: { href: '#stands/' + app.selectedPropertyUID() }">
												<span class="tab-num">2</span>
												Define Stand Boundaries</a>
										</li>
										<li>
											<a data-bind="attr: { href: '/trees/strata/' + app.selectedPropertyUID() }">
												<span class="tab-num">3</span>
												Define Vegetation Types</a>
										</li>
										<li data-bind="css: { active: app.state() == 'scenarios'}">
											<a data-bind="attr: { href: '#scenarios/' + app.selectedPropertyUID() }">
												<span class="tab-num">4</span>
												Evalutate Future Scenarios</a>
										</li>
										<!--									
										//  @TODO app.properties.viewModel.selectedProperty() doesn't exist yet. Will need to
										apply bindings to the tabs in a callback. doing it on doc.ready for now.
										or ko.observable set when this is ready
										<li data-bind="css: {active: app.state('scenarios') }"><a href="#scenarios" data-bind=" 
											css: {disabled: app.properties.viewModel.selectedProperty().stand_summary.with_condition() <
											app.properties.viewModel.selectedProperty().stand_summary.total()}">Evalutate Future Scenarios</a></li>
											-->
									</ul>
						</div>






        <div class="row-fluid">
          <div class="span5">
						
            <div id="property-html" data-bind="visible: showPropertyPanels" > 

                <div class="well clearfix" style="display:none;" data-bind="visible: propertyList().length === 0 &&
                  showNoPropertiesHelp"> 
                    <!-- data-bind="if: showNoPropertiesHelp"> -->
                    <h2>Create Properties</h2>
                    <p><em>You currently have no properties under management.</em></p>
                    <div id="properties-none">
                        <p>When your property is in view on the map, click the button below to draw the boundaries of your first property.</p>
                        <div class="btn-group pull-right">
                            <button href="#" class="btn" data-bind="click: startUpload, disable: preventUpdates">
                                <i class="icon-upload"></i> Upload GIS Data</button>
                            <button href="#" class="btn btn-success" 
                                data-bind="click: startAddDrawing, disable: preventUpdates">Draw Property Boundary</button>
                        </div>
                    </div> <!-- no properties -->
                </div><!-- end of no properties -->


								<div id="properties-list" style="display: none;" class="row-fluid" data-bind=" visible: showDetailPanel">

                  <!--<h2> My Properties </h2>-->
                  <p class="info-help info text-info well well-small clearfix">
                    <i class="icon-info-sign"></i> 
                    <strong>A property is the unit of analysis by which scenarios are developed.  </strong>
                    <span>You may have one or more properties.  Stands and Vegetation types must be defined for a
                      property before you are able to develop different management scenarios.  If you have a
                      non-contiguous property, you must load the data from a pre-existing GIS file.  You can enter as
                      many properties as you want however scenarios can only be run on one property at a time.</span>
                  </p>

                  <div class="row-fluid btn-bar clearfix">
                    <a class="btn pull-right btn-success" href="#" data-bind="click: startAddDrawing, disable: preventUpdates">
                      <i class="icon-plus-sign icon-white"></i> Draw New Property
                    </a>

                    <a class="btn pull-left" href="#" data-bind="click: startUpload, disable: preventUpdates">
                      <i class="icon-upload"></i> Upload GIS Data
                    </a>
                  </div>

                  <ul class="property-list" data-bind="visible: propertyList().length > 0,foreach: propertyList">
                    <li class="property-box clearfix well" 
                        data-bind="
                          css: { active: $data === $parent.selectedProperty()}, 
                          click: $parent.selectProperty
                    ">
                      <h3  data-bind="text: name"></h3>
                      <div class="row-fluid">
                        <div class="span6">
													<dl class="dl-horizontal">
														<dt>Area</dt>
														<dd><span data-bind="text: acres()"></span> acres</dd>
														<dt>Location</dt>
														<dd data-bind="foreach: location">
															<span data-bind="text: $data"></span><!-- ko if: $index() == 0 -->, <!-- /ko -->
														</dd>
                            <dt># Stands</dt>
                            <dd data-bind="text: stand_summary.total"></dd>
                          </dl>

                          <a href="#" class="more-toggle">dev more...</a>
                          <dl class="hide more dl-horizontal">
                            <dt>Number of Stands</dt>
														<dd>
															<span data-bind="text: stand_summary.with_strata"></span> 
															of <span data-bind="text: stand_summary.total"></span> with strata 
														</dd>
														<dd>
															<span data-bind="text: stand_summary.with_condition"></span> 
															of <span data-bind="text: stand_summary.total"></span> with condition 
														</dd>
														<dd>
															<span data-bind="text: stand_summary.with_terrain"></span> 
															of <span data-bind="text: stand_summary.total"></span> with terrain 
														</dd>

													</dl>
                        </div> <!-- /.span4 -->
                        <div class="span6" style="text-align: center;">

                          <!--
                            <button class="btn btn-info center" 
                              data-bind="click: $parent.selectProperty,
                              css: { active: $data === $parent.selectedProperty()}
                              ">Select</button>
                          -->
                            
                          <div class="btn-group center">
                            <button id="delete-button" class="btn btn-mini" 
                              data-bind="click: $parent.showDeleteDialog"><i class="icon-remove"></i> Delete </button>
                            <button class="btn btn-mini"  
                              data-bind="click: $parent.showEditForm, disable: $parent.preventUpdates">
                              <i class="icon-edit"></i> Edit </button>
                          </div>
                        </div> <!-- /.span6 -->
                      </div> <!-- /.row-fluid inner li -->

                          <!--
                        <div class="btn-group" data-bind="visible: confirmDelete">
                          <button class="btn" data-bind="click: function () { confirmDelete(false) }">cancel</button>
                          <button class="btn" data-bind="click: deleteStratum">ok</button>
                        </div>
                        <div class="btn-group" data-bind="visible: confirmDelete() === false">
                          <button class="btn btn-success" data-bind="click: $parent.applyStrata">Select</button>
                          <button class="btn" data-bind="click: $parent.editStratum"><i class="icon-edit"></i></button>
                          <button class="btn" data-bind="click: function () { confirmDelete(true) }"><i class="icon-remove"></i></button>
                        </div>
                        -->
                    </li>
                  </ul>

                  <a href="#stands" class="btn btn-primary btn-large" 
                    data-bind="visible: selectedProperty()">
                    <strong>Next</strong>: Create or edit stands for 
                    <strong><em data-bind="text: app.selectedPropertyName()"></em></strong>
                    <i class="icon-arrow-right"></i>
                  </a>

                </div> <!-- #properties-list -->


                <div class="row-fluid"><!-- panels -->
                  <div>
                    <div style="display:none" data-bind="visible: showUploadPanel">
                      <h2>Upload stands</h2>
                      <p> File upload </p>
                      <ul> 
                          <li> A .zip file containing an ESRI Shapefile </li>
                          <li> Projected to Web Mercator coordinates </li>
                          <li> Shapefile contains polygons of all stands comprising the property</li>
                      </ul>
                      <div class="well">
                      <form id="uploadForm" action="{% url 'trees-upload_stands' %}" method="post" enctype="multipart/form-data"> 
                            <input type="hidden" name="MAX_FILE_SIZE" value="100000">
                            <p> 
                                <label for="upload-propertyname">
                                    <span id="upload-propertyname-required" class="label label-important"
                                        style="display:none;"> 
                                        Required 
                                        <i class="icon-exclamation-sign icon-white"></i> 
                                    </span>
                                    &nbsp; New Property Name
                                </label>
                                <input type="text" id="upload-propertyname" name="new_property_name" size="10"/>
                            </p>
                            <p> 
                                <span id="upload-file-required" class="label label-important"
                                    style="display:none;"> 
                                    Required 
                                    <i class="icon-exclamation-sign icon-white"></i> 
                                </span>
                                <input type="file" id="upload-file" name="ogrfile" size="10"/> 
                            </p>
                            <div class="pull-right">
                                <a href="#" class="btn" data-bind="click: cancelUpload">Cancel</a>
                                <input id="uploadbutton" type="submit" class="btn btn-success" value="Upload"/>
                            </div>
                      </form>
                      <div id="uploadProgress" style="display: none; width:80%;" class="progress progress-striped active">
                        <div class="bar" style="width: 0%;"></div>
                      </div>
                      <div id="uploadResponse" style="width: 80%; font-size: 125%;"></div>
                      </div>
                    </div>
                    <div style="display:none" data-bind="if: showDrawHelpPanel, visible: showDrawHelpPanel">
                      <h2>Draw Property Boundary</h2>
                      <p> Double-click to complete polygon. </p>
                      <div class="pull-right">
                        <a href="#" class="btn" data-bind="click: cancelEdit">Cancel</a>
                      </div>
                    </div>

                    <div class="form-panel" style="display: none" data-bind="if: showEditPanel, visible: showEditPanel">
                      <h2>Edit Property</h2>
                      <div id="edit-panel"></div>
                      <div class="pull-right" id="edit-panel-buttons">
                        <a href="#" class="btn" data-bind="click: cancelEdit">Cancel</a>
                        <a href="#" class="btn btn-success" data-bind="click: updateFeature">Save changes</a>
                      </div>
                    </div>
                    <div class="form-panel" style="display:none" data-bind="if: showCreatePanel, visible: showCreatePanel">
                      <h2>Create Property</h2>
                      <div id="create-panel"></div>
                      <div class="pull-right" id="create-panel-buttons">
                        <a href="#" class="btn" data-bind="click: cancelEdit">Cancel</a>
                        <a href="#" class="btn btn-success" data-bind="click: addFeature">Create</a>
                      </div>
                    </div>
                  </div>
              </div>

              <div class="modal" id="delete-dialog" style="display:none">
                <div class="modal-header">
                  <a class="close" data-dismiss="modal">×</a>
                  <h3>Delete Property</h3>
                </div>
                <div class="modal-body">
                  <div data-bind="if: selectedProperty()">
                    Are you sure you want to delete the property "<strong data-bind="text: selectedProperty().name"></strong>"?
                  </div>
                </div>
                <div class="modal-footer">
                  <a href="#" class="btn" data-dismiss="modal">cancel</a>
                  <a href="#" class="btn btn-danger" data-bind="click: deleteFeature">Delete Property</a>
                </div>
              </div>

            </div> <!-- end of property pages -->









            <div id="scenario-html" style="display: none" data-bind="visible: showScenarioPanels, if: showScenarioPanels">
              <div class="row-fluid" data-bind="visible: showScenarioList">

				  <!--
                <div class="span12 well">
                    <h3>Scenario List</h3>
                    <p>
                    </p>
                    <div>
                        <ul class="nav nav-tabs nav-stacked" data-bind="foreach: scenarioList">
                            <li data-bind="click: $parent.toggleFeature, css: { active: $parent.selectedFeatures.indexOf($data) != -1  }">
                            <a href="#"> 
                                <i style="width:14px; height:14px; padding-right: 6px;" class="icon-ok"
                                   data-bind="css: { 'icon-white': $parent.selectedFeatures.indexOf($data) == -1 }"></i>
                                <span data-bind="text: fields.name">
                            </a>
                            </li>
                        </ul>
                    </div>
                </div>
				-->
                <!--<h2>Evaluate Scenarios</h2>-->
                <p class="info-help info text-info well well-small clearfix">
                  <i class="icon-info-sign"></i> 
                  <strong>Scenarios represent a plausible future outcome given a set of defined management activities.</strong>
                  <span>
                    You can create and compare as many scenarios as you like.  Scenarios are made up of specific
                    management activities called &ldquo;prescriptions&rdquo; applied to individual stands.  When
                    creating and selecting prescriptions for specific locations (stands) you should consider management
                    objectives, site conditions, cost constraints (e.g. whether there are existing roads) and any other
                    spatial constraints (e.g. riparian buffer regulations, avoiding steep and hazardous slopes or
                    conservation easements).  You must define specific management activities or
                    &ldquo;prescriptions&rdquo; that can then be applied to one or more stands (in the same manner that
                    you apply vegetation types to stands).  Once you create a prescription for one scenario, the
                    prescription is available for use in other scenarios.  Once you have created a scenario, it will
                    show up in the list on the left hand side of the page.  To view and compare outcomes for scenarios,
                    merely check the box next to the scenario name.  
                  </span>
                </p>

                <div class="well">
                    <div class="hide" data-bind="if: scenarioList().length == 0" style="text-align:center">
                        <p class="muted" style="margin-top: 88px; margin-bottom: 88px;" data-bind="visible: scenarioList().length === 0">
                           Create a New Scenario to evaluate.
                       </p>
                    </div>
                    <div>  
                      <header class="clearfix">
                        <div class="btn-grouppull-right">
                          <button class="btn btn-mini" data-bind="click: reloadScenarios"> 
                            <i class="icon-repeat"></i> Refresh
                          </button>
                          <a href="#" class="btn btn-success pull-right" data-bind="click: newScenarioStart">
                            <i class="icon-plus-sign icon-white"></i> New Scenario
                          </a>
                        </div>
                      </header>

                        <table class="table table-condensed table-hover table-bordered">
                        <tbody data-bind="foreach: scenarioList">
                            <tr class="scenario-row" data-bind="click: $parent.toggleFeature">
                                <td data-bind="css:{ 'highlighted-scenario': $parent.selectedFeatures.indexOf($data) !== -1 }"> 
                                    <div class="pull-right btn-group">
                                        <button href="#" id="delete-button" class="btn btn-mini" 
                                            data-bind="click: $parent.showDeleteDialog">
                                            <i class="icon-remove"></i>Delete</button>
                                        <button class="btn btn-mini" href="#" 
                                            data-bind="click: $parent.editFeature, visible: fields.property_is_runnable, css: {'btn-danger': !fields.is_runnable || fields.needs_rerun }">
                                            <i class="icon-edit" data-bind="css: {'icon-white': !fields.is_runnable || fields.needs_rerun }"></i>Edit</button>
                                    </div>

                                    <div class="pull-left" style="margin: 12px; padding:2px; border:1px #ddd solid">
                                        <i style="width:14px; height:14px;" 
                                           class="icon-ok"
                                           data-bind="css: { 'icon-white': $parent.selectedFeatures.indexOf($data) == -1 }">
                                        </i>
                                    </div>
                                    <h5> <span data-bind="text: fields.name"><span> </h5>
                                    <span data-bind="text: fields.description"></span>
                                    <p>
                                    <div class="scenario-details" style="padding-left: 8px; padding-right: 8px;">
                                        <div data-bind="visible: !fields.is_running" > 
                                            <div class="alert alert-danger" data-bind="visible: !fields.property_is_runnable" >
                                                <i class="icon-exclamation-sign icon-white"></i>
                                                All stands must be 
                                                <a data-bind="click: $parent.manageVegetationTypes,
                                                  clickBubble: false">
                                                  assigned a vegetation type</a> to proceed.
                                            </div>
                                            <div data-bind="visible: fields.property_is_runnable">
                                                <div class="alert" data-bind="visible: !fields.is_runnable" > 
                                                    <i class="icon-exclamation-sign icon-white"></i>
                                                    Scenario needs to be updated; Please <strong>Edit</strong> and apply a Rx to all stands (Step 2).
                                                </div>
                                                <div data-bind="visible: fields.is_runnable" > 
                                                    <div class="alert" data-bind="visible: fields.needs_rerun" > 
                                                        <i class="icon-exclamation-sign icon-white"></i>
                                                        Stands have changed since scenario was created; Please <strong>Edit</strong> and re-Submit.
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="alert alert-info" data-bind="visible: fields.is_running" > 
                                            <i class="icon-refresh icon-white"></i>
                                            Scenario is currently in the task queue. Check back and hit Refresh in a few seconds.
                                        </div>
                                    </div>
                                    </p>
                                </td>
                            </tr>
                        </tbody>
                        </table>

                    </div>
                </div>
              </div>
              <div class="modal" id="scenario-delete-dialog" style="display:none">
                <div class="modal-header">
                    <a class="close" data-dismiss="modal">×</a>
                    <h3>Delete Stand</h3>
                </div>
                <div class="modal-body">
                    <div data-bind="if: activeScenario">
                    Are you sure you want to delete this stand?"?
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#" class="btn" data-dismiss="modal">cancel</a>
                    <a href="#" class="btn btn-danger" data-bind="click: deleteFeature">Delete Scenario</a>
                </div>
              </div>
            </div>

            <!-- these are all stand pages -->
            <div id="stand-html" style="display: none" data-bind="visible: showStandPanels, if: showStandPanels">
              <div class="row-fluid">
                <!--<h2>Stand Boundaries</h2>-->
                <div data-bind="visible: showStandList">

                  <p class="info-help info text-info well well-small">
                    <i class="icon-info-sign"></i> 
                    <!-- Select a stand on the map to see or edit the stand's details. -->

                  <strong>A stand is your primary management unit to which you would apply on the ground prescriptions.  </strong>
                  <span>Generally you will digitize stands based on a combination of vegetation characteristics,
                    regulatory constraints, infrastructure (e.g. roads or landing sites) and harvest considerations such
                    as minimum or maximum size of a harvest unit.  Digitize a stand for all forested areas on your
                    property including recent clear cuts.  Non-forested areas (such as rocky outcrops, farm or pasture
                    land or major roads) should not be digitized as stands.   Each stand must be digitized in its
                    entirety; in other words, you must trace the boundary of pre-existing, adjacent stands when adding
                    new stands.</span>
                  </p>

                  <div class="btn-bar clearfix">
                    <!--
                      <button class="btn tool-tip" data-toggle="tooltip" title="If you already have GIS data..."><i class="icon-upload"></i> Upload Stands</button>
                      <button class="btn tool-tip" data-bind="click: cancelManageStands"><i class="icon-arrow-left"></i> Back to Properties</button>
                      <a class="btn tool-tip" href="#" data-toggle="tooltip" title="Stand groups are ..." 
                        data-bind="attr: { href: '/trees/strata/' + app.selectedPropertyUID() }" >
                        <i class="icon-repeat"></i> Define Stand Groups</a>
                      -->
                    <button class="btn btn-success pull-right" href="#" data-bind="click: addStandStart, visible: standList().length">
                      <i class="icon-plus-sign icon-white"></i> Draw a New Stand</button>
                  </div>

                  <div class="loading" data-bind="visible: showProgressBar">
                    <h3>Loading...</h3>
                  </div>
					<!-- 
					<div class="progress progress-striped active" data-bind="visible: showProgressBar">
					  <div class="bar" style="width: 100%"></div> 
					  <div class="bar" data-bind="style: { width: progressBarWidth() }"></div>
					</div>
					-->

                  <p data-bind="visible: ! standList().length"></p>
                  <div data-bind="if: standList().length > 0">
                  <div class="row-fluid">
                    <div class="well">
                        <div class="pull-right btn-group">
                            <button href="#" id="delete-button" class="btn btn-mini" 
                                data-bind="click: showDeleteDialog"><i class="icon-remove"></i> Delete</button>
                            <button class="btn btn-mini" href="#" 
                                data-bind="click: editStand">
                                <i class="icon-edit"></i> Edit</button>
                        </div>
                        <h3>Stand Details</h3>
                        <div class="stand-detail" data-bind="with: selectedFeature">
                            <p>
                                <dl class="dl-horizontal">
                                  <dt>Area</dt>
                                  <dd><span data-bind="text: acres"></span> acres</dd>
                                  <dt>Aspect</dt><dd><span data-bind="text: aspect"></span>&nbsp;</dd>
                                  <dt>Slope</dt><dd data-bind="text: slope">&nbsp;</dd>
                                  <dt>Elevation</dt><dd><span data-bind="text: elevation"></span> ft</dd>
                                </dl>

                                <a href="#" class="more-toggle">dev more...</a>
                                <div class="stand-tree-details hide more">
                                    <h4> Strata </h4>
                                    <dl class="dl-horizontal" data-bind="with: strata">
                                        <dt>Strata UID</dt><dd><span data-bind="text: uid"></span></dd>
                                        <dt>Age</dt><dd><span data-bind="text: search_age"></span></dd>
                                        <dt>TPA</dt><dd><span data-bind="text: search_tpa"></span></dd>
                                        <dt>Stand List</dt>
                                        <dd>
                                            <ul data-bind="foreach: stand_list.classes">
                                                <li data-bind="text: $data"></li>
                                            </ul>
                                        </dd>
                                    </dl>

                                    <h4> Nearest Neighbor IDB Plot</h4>
                                    <dl class="dl-horizontal">
                                        <dt>Condition ID</dt><dd><span data-bind="text: cond_id"></span></dd>
                                        <dt>Condition Age</dt><dd><span data-bind="text: condition_age"></span></dd>
                                        <dt>Stand List</dt>
                                        <dd>
                                            <ul data-bind="foreach: condition_stand_list">
                                                <li data-bind="text: $data"></li>
                                            </ul>
                                        </dd>
                                    </dl>
                                </div>

                            </p>
                      </div>
                    </div>

                  </div>
                  </div>
                  <!--
                  <div data-bind="if: standList().length, visible: standList().length > 10">
                    <div class="pagination">
                      <ul data-bind="foreach: paginationList">
                        <li data-bind="click: $parent.setListIndex, css: { 'active': $parent.listStart() === listIndex, 'disabled': displayIndex === '...' }">
                          <a href="#" data-bind="text: displayIndex, attr: { title: listIndex }"></a>
                        </li>
                      </ul>
                    </div>
                  </div>
                  -->
                  <div id="stands-none" class="well clearfix" data-bind="visible: ! standList().length">
                    <h3>Define New Stand Boundaries</h3>
                    <p>Then you will be asked to enter some additional information to help describe your property.</p>
                    <div class="pull-right">
                      <button href="#" class="btn" data-bind="click: cancelManageStands">Cancel</button>
                      <button href="#" class="btn btn-success" data-bind="click: addStandStart"><i class="icon-plus-sign icon-white"></i> Draw a New Stand</button>
                    </div>
                  </div>
                </div>
                <div data-bind="visible: showDrawPanel">
                  <h3>Draw your stand</h3>
                  <p>Starting drawing your stand. Double-click to finish.</p>
                  <div class="pull-right">
                    <button href="#" class="btn" data-bind="click: cancelAddStand">Done</button>
                  </div>
                </div>
              </div> <!-- no properties -->
              <div class="row-fluid" data-bind="visible: showStandFormPanel">
                <h3>Confirm Stand Boundaries</h3>
                <div id="stands-form-container" class="form-panel"></div>
                <div class="pull-right">
                  <button href="#" class="btn" data-bind="click: cancelAddStand">Cancel</button>
                  <button href="#" class="btn btn-success" data-bind="click: saveStandForm">Save Stand</button>
                </div>
              </div>

              <div class="modal" id="stand-delete-dialog" style="display:none">
                <div class="modal-header">
                    <a class="close" data-dismiss="modal">×</a>
                    <h3>Delete Stand</h3>
                </div>
                <div class="modal-body">
                    <div data-bind="if: selectedFeature()">
                    Are you sure you want to delete this stand?
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#" class="btn" data-dismiss="modal">cancel</a>
                    <a href="#" class="btn btn-danger" data-bind="click: deleteFeature">Delete Stand</a>
                </div>
              </div>
            </div>
            <!-- end of stand pages -->
            <!-- scenario pages -->
            <div class="row-fluid hide" id="scenario-form-metacontainer">
            <h3>Define your scenario</h3>
                <div class="well">
                    <div id="scenario-form-container">
                        <h4>Loading...</h4>
                    </div>
                </div>
            </div>
          {% endif %}
          </div>
          <div class="span7">
              {% if user.is_authenticated %}
            <div class="outermap well">
              <!-- Not sure why but non authenticated requests cause failure in geoSearch knockout binding -->

              <div id="searchbox-container" class="pull-right">
                {% include "common/geosearch.html" %}
              </div>

              <div id="map"></div>

              <div id="scenario-outputs" style="display:none">
                    <ul class="nav nav-tabs" id="myTab">
                        <li class="active"><a href="#scenario-charts-tab-content" id="scenario-charts-tab" data-toggle="tab">Charts</a></li>
                        <li>
                            <a href="#scenario-maps-tab-content" id="scenario-maps-tab" data-toggle="tab">Time-series Maps</a>
                        </li>
                        <li>
                            <a href="#scenario-cash-tab-content" id="scenario-cash-tab" data-toggle="tab">Costs</a>
                        </li>
                    </ul>
                    
                    <div class="tab-content no-overflow">

                        <div class="tab-pane fade active in" id="scenario-charts-tab-content">
                            <div>
                                <select id="chart-metrics-select" class="selectpicker"></select>
                                <p class="muted" style="margin: 25px; font-size: 16pt;" 
                                   data-bind="visible: scenarioList().length > 0 && selectedFeatures().length === 0">
                                    Select one or more scenarios to evaluate.
                                </p>  
                                <p class="muted" style="margin: 25px; font-size: 18pt;" 
                                   data-bind="visible: scenarioList().length == 0">
                                    Loading Scenarios...
                                </p>  
                            </div>
                            <div id="chart-scenario" class="chart"></div>
                        </div>

                        <div class="tab-pane fade" id="scenario-maps-tab-content">
                            <div>
                                <div class="row-fluid">
                                    <div class="span3">
                                        <select id="timemap-metrics-select" class="selectpicker">
                                            <!-- populated by init.js -->
                                        </select>
                                    </div>
                                    <div class="span9">
                                        <div class="row-fluid">
                                            <div class="span5">
                                                <span class="pull-right"> 
                                                  <input class="input-mini slidervalue year-slider-value" 
                                                      type="text" name="year-slider" id="field-year-slider" />
                                                </span>
                                            </div>
                                            <div class="span1">
                                              <button id="timemap-backward" class="pull-right btn btn-link">
                                                <i class="icon-backward"></i>
                                              </button>
                                            </div>
                                            <div class="span5" style="margin:10px 0;">
                                                <div class="slider" id="slider-year-slider">
                                                </div> 
                                            </div>
                                            <div class="span1">
                                              <button id="timemap-forward" class="pull-left btn btn-link">
                                                <i class="icon-forward"></i>
                                              </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div style="margin-top: 12px;">
                                <div class="timemap-container" style="position:relative;">
                                    <div class="well hide error-timemap alert alert-error" id="error-timemap1">
                                        <p> This scenario doesn't have valid modeling results... </p>
                                    </div>
                                    <div class="timemap" id="timemap1"></div>
                                    <select id="select-scenario1" class="scenario-select" data-bind="foreach: selectedFeatures">
                                        <option data-bind="value: pk, text: fields.name"></option>
                                    </select>
                                </div>
                                <div class="timemap-container" style="position:relative;">
                                    <div class="well hide error-timemap alert alert-error" id="error-timemap2">
                                        <p> This scenario doesn't have valid modeling results... </p>
                                    </div>
                                    <div class="error-timemap" id="timemap-legend"></div>
                                    <div class="timemap" id="timemap2"></div>
                                    <select id="select-scenario2" class="scenario-select" data-bind="foreach: selectedFeatures">
                                        <option data-bind="value: pk, text: fields.name"></option>
                                    </select>
                                    <!--
                                    <select data-bind="options: selectedFeatures, 
                                                       optionsText: 'fields.name', 
                                                       optionsValue: 'pk'"></select>
                                    -->
                                </div>

                            </div>
                        </div>

                        <div class="tab-pane fade" id="scenario-cash-tab-content">
                            <p class="info-help info text-info well well-small">
                              <i class="icon-info-sign"></i> 
                              <strong>Harvesting and transportation costs for each scenario.</strong>
                            </p>
                            <br>
                            <div id="cash1">
                              <select id="cash-select-scenario1" 
                                      data-bind="foreach: selectedFeatures">
                                  <option data-bind="value: pk, text: fields.name"></option>
                              </select>
                              <p class="muted" id="loading-cash-chart1" style="margin: 8px; font-size: 18pt;">
                                  Calculating Cost/Revenue...
                              </p>
                            </div>
                            <div id="cash-chart1" class="cash-chart"></div>
                            <hr>
                            <div id="cash2">
                              <select id="cash-select-scenario2"
                                      data-bind="foreach: selectedFeatures">
                                  <option data-bind="value: pk, text: fields.name"></option>
                              </select>
                              <p class="muted" id="loading-cash-chart2" style="margin: 8px; font-size: 18pt;">
                                  Calculating Cost/Revenue...
                              </p>
                            </div>
                            <div id="cash-chart2" class="cash-chart"></div>
                        </div>
                    </div>
              </div> <!-- end scenario-outputs -->
              
						</div><!-- /.outer-map -->
              {% endif %}
					</div> <!-- /.span7 (right UI) -->
        </div>
      </div>
      <!-- end partial -->

{% endblock content %}

{% block styles %}
		{% if user.is_authenticated %}
    <link rel="stylesheet" type="text/css" href="{{MEDIA_URL}}jqplot/jquery.jqplot.min.css" />
    <link rel="stylesheet" type="text/css" href="{{MEDIA_URL}}common/css/jquery-widgets.css" />
    <link rel="stylesheet" type="text/css" href="{{MEDIA_URL}}common/css/decisiontree.css" />
    <link rel="stylesheet" type="text/css" href="{{MEDIA_URL}}support/bootstrap-select/bootstrap-select.min.css" />
    {% endif %}
{% endblock styles %}

{% block scripts %}

{% if user.is_authenticated %}
    <!--[if lt IE 9]><script language="javascript" type="text/javascript" src="{{MEDIA_URL}}/jqplot/excanvas.js"></script><![endif]-->
    <script src="{{MEDIA_URL}}common/js/underscore.string.min.js"></script>
    <script class="include" type="text/javascript" src="{{MEDIA_URL}}jqplot/jquery.jqplot.min.js"></script>
    <script class="include" type="text/javascript" src="{{MEDIA_URL}}jqplot/plugins/jqplot.canvasTextRenderer.min.js"></script>
    <script class="include" type="text/javascript" src="{{MEDIA_URL}}jqplot/plugins/jqplot.canvasAxisLabelRenderer.min.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}jqplot/plugins/jqplot.dateAxisRenderer.min.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}jqplot/plugins/jqplot.canvasTextRenderer.min.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}jqplot/plugins/jqplot.canvasAxisTickRenderer.min.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}jqplot/plugins/jqplot.categoryAxisRenderer.min.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}jqplot/plugins/jqplot.enhancedLegendRenderer.min.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}jqplot/plugins/jqplot.barRenderer.min.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}jqplot/plugins/jqplot.highlighter.min.js"></script>

    <script src="{{MEDIA_URL}}jqplot/plugins/jqplot.dateAxisRenderer.min.js"></script>
    <script src="{{MEDIA_URL}}jqplot/plugins/jqplot.highlighter.min.js"></script>
    <script src="{{MEDIA_URL}}jqplot/plugins/jqplot.enhancedLegendRenderer.min.js"></script>
    <script src="{{MEDIA_URL}}common/js/chart.js"></script>
    <script src="{{MEDIA_URL}}common/js/jquery.scrollTo-1.3.3-min.js"></script>
    <script src="{{MEDIA_URL}}common/js/jquery.easing.1.3.js"></script>
    <script src="{{MEDIA_URL}}common/js/decisiontree.js"></script>
    <script src="{{MEDIA_URL}}common/js/jquery-ui.min.js"></script> 
    <script src="{{MEDIA_URL}}common/js/jquery.ui.slider.js"></script> 
    <script src="{{MEDIA_URL}}support/bootstrap-select/bootstrap-select.min.js"></script> 

    {% load compressed %}
    <script type="text/javascript">

        // if console is undefined, use an empty function so console.log wont break old browsers
        if ( ! window.console ) console = { log: function(){}, info: function(){}, warn: function(){} };

        var madrona = {
            onShow: function (callback) {
                callback();
                //madrona.formCallbacks.push(callback);
            }, 
            formCallbacks: [],
            features: {}
        };

        var app = {
            stands: {},
            scenarios: {},
            properties: {}
        };

        {% if user.is_authenticated %}
        $.get('/features/{{user.username}}/workspace-owner.json', function (data) {
            app.workspace = data;
        });
        {% else %}
        $.get('/features/workspace-public.json', function (data) {
            app.workspace = data;
        });
        {% endif %}

    </script>
    <script type="text/javascript" src="{{MEDIA_URL}}features/js/workspace.js"></script>
    <script src="http://maps.google.com/maps/api/js?v=3.5&amp;sensor=false"></script>
    <script src="{{ MEDIA_URL }}OpenLayers.js"></script>
    {% compressed_js 'application' %}

    <script src="{{ MEDIA_URL }}common/js/hash_routing.js"></script>
    <script src="{{ MEDIA_URL }}common/js/geosearch.js"></script>
    <script src="{{ MEDIA_URL }}common/js/init.js"></script>
    <script src="{{ MEDIA_URL }}common/js/breadcrumbs.js"></script>
    <script src="{{ MEDIA_URL }}common/js/timemap.js"></script>
    <script src="{{ MEDIA_URL }}common/js/cashflow.js"></script>
{% else %}
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.3/jquery.backstretch.min.js"></script>


<script>
	/* homepage */
		$(document).ready(function(){

				 $.backstretch([
					 "/media/img/forest_photos/forest-clouds-866-full-sat.jpg",
					 "/media/img/forest_photos/walkers-205-full-sat.jpg",
					 "/media/img/forest_photos/Nursery-log-1-full-sat.jpg",
           // by John David Nelson 
           // http://www.flickr.com/photos/jondavidnelson/6009713015/sizes/l/in/photostream/
					 "/media/img/forest_photos/pine-jondavidnelson.jpg"
					], {duration: 6000, fade: 1000});
				});

        /* Maybes
          http://www.flickr.com/photos/proforged/6181409251/
          http://www.flickr.com/photos/parksjd/5286896789/
          http://www.flickr.com/photos/wastatednr/5286181483/
          http://www.flickr.com/photos/sbeebe/7258372864/

         */


</script>
{% endif %}

{% endblock scripts %}
