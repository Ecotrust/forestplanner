{% extends 'common/base.html' %}
{% load url from future %}

{% block content %}
   <!-- this should go into a partial -->
      <!--
      <div class="row-fluid">
        <div class="span5">
          <div><h1>Manage Properties</h1></div>
        </div>
        <div class="span7">
          <span class="pull-right">
            {% include "common/geosearch.html" %}
          </span>
        </div>
      </div>
      -->
        <div class="row-fluid">
          <div class="span6">
            <ul id="breadcrumbs" class="breadcrumb" data-bind="foreach: breadcrumbs">
              <li data-bind="visible: ! $parent.isLast($data)">
                <a data-bind="text: name, click: action"></a>
                  <span class="divider">/</span>
              </li>
              <li class="active" data-bind="visible: $parent.isLast($data)">
                <span data-bind="text: name"></span>
              </li>
            </ul>
            <div id="home-html" class="hero-unit">

                <h2>An Online Tool for Forest Management Scenario Planning</h2>
                <div>
                    <img src="/media/img/fsp_carousel.jpg" />
                    <br/>
                    <br/>
                    <p>&nbsp;&nbsp;&nbsp;&nbsp;Ecotrust is developing online software that will give all Oregon and Washington 
                    land managers forest managment scenario planning capacity. You will be able to visualize 
                    alternative management scenarios on your lands and receive immediate feedback on how  
                    decisions might pay off in terms of timber harvests and financial returns, as well as 
                    public benefits like carbon storage and ecosystem services. </p>
                    
                    <p>
                    {% if not user.is_authenticated %}
                    <div class="btn-group pull-right">
                        <a class="btn btn-large" href="{% url 'registration_register' %}" id="register">Register</a>
                        <a class="btn btn-large" href="{% url 'user_signin' %}" id="signin">Sign In</a>
                    </div>
                    {% else %}
                    <a class="btn btn-large btn-success pull-right" id="manage-your-properties" href="#">Manage Your Properties</a>
                    {% endif %}
                    </p>                
                </div>
                <div class="well hide">
                    <h3> Using the Scenario Planning Tool</h3>
                    <ul>
                        <li>Identify their properties on an interactive map </li>
                        <li>Use preloaded Forest Inventory Analysis data (FIA) or upload their own cruise data.</li>
                        <li>Designate forest management areas or stands</li>
                        <li>Define management prescriptions</li>
                        <li>Specify timber and carbon market prices</li>
                    </ul>
                        
                    <h3> Scenario Planning Tool Outputs:</h3>
                    <ul>
                        <li>Graphs of timber volume and financial returns generated over time</li>
                        <li>Optimized harvest schedule</li>
                        <li>Maps of standing timber volume, species and age class over time</li>
                        <li>Visualize potential to realize carbon credits and ecostytem-based incentives over time</li>
                    </ul>

                    <h3> Additional Features</h3>
                    <ul>
                        <li>Secure and confidentially store and manage data and scenario runs</li>
                        <li>Share scenarios between collaborators to explore collaborative decision making among forest landowners and managers</li>
                    </ul>
                </div>
            </div>
            {% if user.is_authenticated %}
            <!-- these are all property pages -->
            <div id="property-html" class="well" data-bind="visible: showPropertyPanels" > <!-- need to make this a different color -->
               <div class="modal" id="delete-dialog" style="display:none">
                <div class="modal-header">
                  <a class="close" data-dismiss="modal">×</a>
                  <h3>Delete Property</h3>
                </div>
                <div class="modal-body">
                  <div data-bind="if: selectedProperty()">
                    Are you sure you want to delete "<span data-bind="text: selectedProperty().name"></span>"?
                  </div>
                </div>
                <div class="modal-footer">
                  <a href="#" class="btn" data-dismiss="modal">cancel</a>
                  <a href="#" class="btn btn-danger" data-bind="click: deleteFeature">Delete Property</a>
                </div>
              </div>
              <div class="row-fluid" style="display:none" data-bind="if: showNoPropertiesHelp">
                <h2>Create Properties</h2>
                <p><em>You currently have no properties under management.</em></p>
                <div id="properties-none">
                  <h3>Draw your property</h3>
                  <p>Find your properties on the map by searching for a placename or parcel id.</p>
                  <div>
                      <form class="form-search">
                          <input type="text" class="input-large search-query" placeholder="placename or parcel id">
                          <button class="btn" type="submit">Search</button>
                      </form>
                  </div>
                  <p>When your property is in view on the map, click the button below to draw the boundaries of your first property.</p>
                  <h3>Add additional information</h3>
                  <p>Then you will be asked to enter some additional information to help describe your property.</p>
                  <div class="pull-right">
                    <button href="#" class="btn" data-bind="click: startUpload, disable: preventUpdates">
                        <i class="icon-upload"></i> Upload</button>
                    <button href="#" class="btn btn-primary" data-bind="click: startAddDrawing, disable: preventUpdates">Add Property</button>
                  </div>
                </div> <!-- no properties -->
              </div><!-- end of no properties -->
              <div>
                <div id="properties-list" style="display: none" data-bind="if: propertyList().length, visible: showPropertyList">
                  <h2>Property List</h2>
                  <p>
                  <div class="btn-group">
                      <button href="#" class="btn" data-bind="click: startAddDrawing, disable: preventUpdates">
                          <i class="icon-plus-sign"></i> Add Property</button>
                      <button class="btn" href="#" data-bind="click: zoomToExtent, disable: preventUpdates">
                          <i class="icon-resize-full"></i> Show All Properties</button>
                      <button href="#" class="btn" data-bind="click: startUpload, disable: preventUpdates">
                          <i class="icon-upload"></i> Upload</button>
                  </div>
                  </p>
                  <div class="row-fluid" style="display:none"  data-bind="visible: propertyList().length">
                    <table class="table table-condensed table-bordered table-hover">
                      <thead><th>Name</th><th>Area (acres)</th><th>County</th></thead>
                      <tbody data-bind="foreach: propertyList">
                        <tr data-bind="click: $parent.selectProperty, css: { active: $data === $parent.selectedProperty() }">
                          <td><a data-bind="text: name"></a></td>
                          <td><span data-bind="text: acres"></span></td>
                          <td><span data-bind="text: location"></span></td>           
                        </tr>
                      </tbody>
                    </table>
                    <div class="pull-right">
                    </div>
                  </div>
                </div><!-- has properties -->
                <div class="row-fluid"><!-- panels -->
                  <div>
                    <div style="display:none" data-bind="visible: showUploadPanel">
                      <h2>Upload stands</h2>
                      <p> File upload </p>
                      <ul> 
                          <li> A .zip file containing an ESRI Shapefile </li>
                          <li> Projected to Web Mercator </li>
                          <li> Contains polygons of all stands </li>
                          <li> Must contain an string attribute field called "name" </li>
                      </ul>
                      <div class="well">
                      <form id="uploadForm" action="{% url 'trees-upload_stands' %}" method="post" enctype="multipart/form-data"> 
                            <input type="hidden" name="MAX_FILE_SIZE" value="100000">
                            <p> 
                                <label for="upload-propertyname">
                                    <span id="upload-propertyname-required" class="label label-important"
                                        style="display:none;"> 
                                        Required 
                                        <i class="icon-exclamation-sign icon-white"></i> 
                                    </span>
                                    &nbsp; New Property Name
                                </label>
                                <input type="text" id="upload-propertyname" name="new_property_name" size="10"/>
                            </p>
                            <p> 
                                <span id="upload-file-required" class="label label-important"
                                    style="display:none;"> 
                                    Required 
                                    <i class="icon-exclamation-sign icon-white"></i> 
                                </span>
                                <input type="file" id="upload-file" name="ogrfile" size="10"/> 
                                <input id="uploadbutton" type="submit" class="btn btn-primary" value="Upload"/>
                            </p>
                            <div class="pull-right">
                                <a href="#" class="btn" data-bind="click: cancelUpload">cancel</a>
                            </div>
                      </form>
                      <div id="uploadProgress" style="display: none; width:80%;" class="progress progress-striped active">
                        <div class="bar" style="width: 0%;"></div>
                      </div>
                      <div id="uploadResponse" style="width: 80%; font-size: 125%;"></div>
                      </div>
                    </div>
                    <div style="display:none" data-bind="if: showDrawHelpPanel, visible: showDrawHelpPanel">
                      <h2>Draw Property Boundary</h2>
                      <p> Double-click to complete polygon. </p>
                      <div class="pull-right">
                        <a href="#" class="btn" data-bind="click: cancelEdit">cancel</a>
                      </div>
                    </div>
                    <div style="display: none;" class="hero-unit property-details" data-bind="if: showDetailPanel, visible: showDetailPanel">
                        <h3>Property Details</h3>
                        <div class="pull-right btn-group">
                          <button href="#" id="delete-button" class="btn btn-mini" 
                              data-bind="click: showDeleteDialog"><i class="icon-remove"></i> Delete Property</button>
                          <button class="btn btn-mini" href="#" 
                              data-bind="click: showEditForm, disable: preventUpdates">
                              <i class="icon-edit"></i> Edit Property</button>
                        </div>
                        <table class="table table-condensed table-bordered" data-bind="if: selectedProperty()">
                            <tr><td>Property Name</td><td><strong><span data-bind="text: selectedProperty().name"><span><strong></td></tr>
                          <tr><td>Area</td><td><span data-bind="text: selectedProperty().acres()"></span> acres</td></tr>
                          <tr><td>County</td><td><span data-bind="text: selectedProperty().location"></span></td></tr>
                        </table>
                        <div class="pull-right btn-group">
                          <button class="btn btn-primary" href="#" data-bind="click: manageScenarios">
                              <i class="icon-repeat"></i> Define Scenarios</button>
                          <button class="btn btn-primary" href="#" 
                              data-bind="click: manageStands"><i class="icon-adjust"></i> Setup Stands</button>
                        </div>
                      </div>
                    </div>
                    <div class="form-panel" style="display: none" data-bind="if: showEditPanel, visible: showEditPanel">
                      <h2>Edit Property</h2>
                      <div id="edit-panel"></div>
                      <div class="pull-right" id="edit-panel-buttons">
                        <a href="#" class="btn" data-bind="click: cancelEdit">cancel</a>
                        <a href="#" class="btn btn-primary" data-bind="click: updateFeature">save changes</a>
                      </div>
                    </div>
                    <div class="form-panel" style="display:none" data-bind="if: showCreatePanel, visible: showCreatePanel">
                      <h2>Create Property</h2>
                      <div id="create-panel"></div>
                      <div class="pull-right" id="create-panel-buttons">
                        <a href="#" class="btn" data-bind="click: cancelEdit">cancel</a>
                        <a href="#" class="btn btn-primary" data-bind="click: addFeature">create</a>
                      </div>
                    </div>
                  </div>
              </div>
            </div>
            <!-- end of property pages -->

            <div id="scenario-html" class="well" style="display: none" data-bind="visible: showScenarioPanels, if: showScenarioPanels">
              <div class="row-fluid" data-bind="visible: showScenarioList">
                <div class="span3">
                    <h3>Scenario List</h3>
                    <p>
                    <div class="btn-group">
                        <a href="#" class="btn" data-bind="click: addScenarioStart"><i class="icon-plus-sign"></i> New Scenario</a>
                    </div>
                    </p>
                    <div>
                        <ul class="nav nav-tabs nav-stacked" data-bind="foreach: scenarioList">
                        <li data-bind="click: $parent.toggleFeature, css: { active: $parent.selectedFeatures.indexOf($data) != -1  }">
                            <a href="#" data-bind="text: fields.name"></a>
                        </li>
                    </ul>
                    </div>
                </div>
                <div class="span9 well">
                    <div data-bind="visible: selectedFeatures().length === 0" style="text-align:center">
                        <p class="muted" style="margin-top: 88px; margin-bottom: 88px;">Click one or more scenarios to evaluate.</p> 
                    </div>
                    <div data-bind="visible: selectedFeatures().length > 0">
                        <h3>Details for Selected Scenarios</h3>
                        <table class="table table-condensed table-striped table-hover table-bordered">
                        <thead>
                            <tr>
                                <td>Name</td>
                                <td>Desc</td>
                                <td>Boardfeet</td>
                                <td>Carbon</td>
                                <td>RXs</td>
                                <td>Date</td>
                            </tr>
                        </thead>
                        <tbody data-bind="foreach: selectedFeatures">
                            <tr>
                                <td data-bind="text: fields.name"></td>
                                <td data-bind="text: fields.description"></td>
                                <td data-bind="text: fields.input_target_boardfeet"></td>
                                <td data-bind="text: fields.input_target_carbon"></td>
                                <td data-bind="text: fields.input_rxs"></td>
                                <td data-bind="text: fields.date_modified"></td>

                                <!--
                                <td data-bind="text: chartColors[0]"></td>
                                <td data-bind="text: $index"></td> 
                                <td data-bind="text: chartColors[$index]"></td>
                                <td><div style="height: 20px; width: 20px; border: 1px grey solid;" data-bind="style: {backgroundColor: chartColors[$index]}"></div></td>
                                -->

                                <!-- <td data-bind="text: fields.output_scheduler_results"></td> -->
                            </tr>
                        </tbody>
                        </table>
                        <div>
                            <!--
                            <select id="select-chart">
                                <option value="timber" SELECTED>Timber</option>
                                <option value="carbon">Carbon</option>
                            </select>
                            -->
                            <div class="well">
                                <div id="chart-carbon" class="chart"></div>
                            </div>

                            <div class="well">
                                <div id="chart-timber" class="chart"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="btn-group pull-right">
                    <button class="btn" data-bind="click: cancelManageScenarios"><i class="icon-backward"></i> Back to Properties </button>
                </div>
              </div>
              <div class="row-fluid" data-bind="visible: showScenarioForm">
                  <h3>Define your scenario</h3>
                  <div id="scenario-form-container"></div>
              </div>
            </div>
            <!-- these are all stand pages -->
            <div id="stand-html" class="well" style="display: none" data-bind="visible: showStandPanels, if: showStandPanels">
              <div class="row-fluid">
                <div data-bind="visible: showStandList">
                  <div class="progress progress-striped active" data-bind="visible: showProgressBar">
                    <div class="bar" data-bind="style: { width: progressBarWidth() }"></div>
                  </div>
                  <p data-bind="visible: ! standList().length"><em>You currently have no stands under management.</em></p>
                  <div data-bind="if: standList().length > 0">
                  <div class="row-fluid">
                    <div class="span3">
                      <h3>Stand List</h3>

                      <p>
                        <div class="btn-group">
                            <a href="#" class="btn" data-bind="click: addStandStart"><i class="icon-plus-sign"></i> Add</a>
                            <a href="#" class="btn" data-bind="click: refineBoundaries"><i class="icon-th"></i> Refine Boundaries</a>
                        </div>
                      </p>
                      <div>
                          <ul class="nav nav-tabs nav-stacked" data-bind="foreach: standListPaginated">
                            <li data-bind="click: $parent.selectFeature, css: { active: $data === $parent.selectedFeature() }">
                                <a href="#" data-bind="text: name"></a>
                            </li>
                        </ul>
                      </div>
                    </div>
                    <div class="span9 well" data-bind="if: selectedFeature">
                      <h3>Stand Details</h3>
                        <div class="pull-right btn-group">
                            <button href="#" id="delete-button" class="btn btn-mini" 
                                data-bind="click: showDeleteDialog"><i class="icon-remove"></i> Delete Stand</button>
                            <button class="btn btn-mini" href="#" 
                                data-bind="click: editStand">
                                <i class="icon-edit"></i> Edit Stand</button>
                        </div>
                      <div class="stand-detail" data-bind="with: selectedFeature">
                        <table class="table">
                          <tr>
                              <td> Name </td>
                              <td>
                                  <span data-bind="text: name"></span>
                                  <!-- <a href="#" class="btn btn-mini pull-right" data-bind="click: $parent.editStand"><i class="icon-edit"></i> Edit</a> -->

                              </td>
                          </tr>
                          <tr>
                            <td>Calculated Area</td><td><span data-bind="text: acres"></span> acres</td>
                          </tr>
                        </table>

                        <h4>Terrain</h4>
                        <table class="table table-condensed">
                        <tr><td>Aspect</td><td data-bind="text: aspect"></td></tr>
                        <tr><td>Slope</td><td data-bind="text: slope">something</td></tr>
                        <tr><td>Elevation</td><td><span data-bind="text: elevation"></span> m</td></tr>
                        </table>

                        <h4>Vegetation</h4>
                        <div class="row-fluid vegetation">
                          <div class="span6">
                            <table class="table table-condensed">
                              <tr><td>Species</td>
                                <td class="value"><span data-bind="text: plot_summaries()[0].fortypiv"></span></td></tr>
                              <tr><td>Height</td>
                                <td class="value"><span data-bind="text: plot_summaries()[0].stndhgt"></span> m</td></tr>
                              <tr><td>Basal area</td>
                                <td class="value"><span data-bind="text: plot_summaries()[0].baa_ge_3"></span> m<sup>2</sup></td>
                              <tr><td>Trees per hectare</td>
                                <td class="value" data-bind="text: plot_summaries()[0].tph_ge_3"></td></tr>
                              <!--
                              <tr><td>mean diameter</td>
                                <td class="value"><span data-bind="text: plot_summaries()[0].qmda_dom"></span> cm</td>
                              <tr><td>conifer proportion</td>
                                <td class="value" data-bind="text: plot_summaries()[0].bac_prop"></td></tr>
                               -->
                            </table>
                          </div>
                          <div class="span6">
                            <div class="thumbnail">
                              <div id="watermarked-image">
                                <p>Sample</p>
                              </div>
                              <h5><span data-bind="text: plot_summaries()[0].vegclass"></h5>
                            </div>
                          </div>
                        </div>
                        <div class="row-fluid">
                          <div class="btn-group pull-right">
                              <!--<button class="btn" href="#"><i class="icon-repeat"></i> Define Scenarios</button> -->
                            <button class="btn" data-bind="click: $parent.cancelManageStands"><i class="icon-backward"></i> Back to Properties </button>
                            <button class="btn" data-bind="click: $parent.refineBoundaries"><i class="icon-leaf"></i> Refine Vegetation</a>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  </div>
                  <div data-bind="if: standList().length, visible: standList().length > 10">
                    <div class="pagination">
                      <ul data-bind="foreach: paginationList">
                        <li data-bind="click: $parent.setListIndex, css: { 'active': $parent.listStart() === listIndex, 'disabled': displayIndex === '...' }">
                          <a href="#" data-bind="text: displayIndex, attr: { title: listIndex }"></a>
                        </li>
                      </ul>
                    </div>
                  </div>
                  <div id="stands-none" data-bind="visible: ! standList().length">
                    <h3>Draw your stand</h3>
                    <p>Find your stands on the map by searching for a placename or parcel id.</p>
                    <p>When your property is in view on the map, click the button below to draw the boundaries of your first property.</p>
                    <h3>Add additional information</h3>
                    <p>Then you will be asked to enter some additional information to help describe your property.</p>
                    <div class="pull-right">
                      <button href="#" class="btn" data-bind="click: cancelManageStands">Return to Properties</button>
                      <button href="#" class="btn btn-primary" data-bind="click: addStandStart">Add Stand</button>
                    </div>
                  </div>
                </div>
                <div data-bind="visible: showDrawPanel">
                  <h3>Draw your stand</h3>
                  <p>Starting drawing your stand... etc</p>
                  <div class="pull-right">
                    <button href="#" class="btn" data-bind="click: cancelAddStand">Cancel</button>
                  </div>
                </div>
              </div> <!-- no properties -->
              <div class="row-fluid" data-bind="visible: showStandFormPanel">
                <h3>Additional Information</h3>
                <div id="stands-form-container" class="form-panel"></div>
                <div class="pull-right">
                  <button href="#" class="btn" data-bind="click: cancelAddStand">Cancel</button>
                  <button href="#" class="btn btn-primary" data-bind="click: saveStandForm">Save Stand</button>
                </div>
              </div>

              <div class="modal" id="stand-delete-dialog" style="display:none">
                <div class="modal-header">
                    <a class="close" data-dismiss="modal">×</a>
                    <h3>Delete Stand</h3>
                </div>
                <div class="modal-body">
                    <div data-bind="if: selectedFeature()">
                    Are you sure you want to delete "<span data-bind="text: selectedFeature().name"></span>"?
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#" class="btn" data-dismiss="modal">cancel</a>
                    <a href="#" class="btn btn-danger" data-bind="click: deleteFeature">Delete Stand</a>
                </div>
              </div>

              <div class="modal" id="refine-boundaries-dialog" style="display:none">
                <div class="modal-header">
                    <a class="close" data-dismiss="modal">×</a>
                    <h3>Refine Stand Boundaries</h3>
                </div>
                <div class="modal-body">
                    <h4> Alter stand boundaries to account for: </h4>
                    <br/> 
                    <div style="margin-left: 12px;">
                        <p><input type="checkbox"/> <strong>Riparian zones</strong> within 100 ft of streams</p>
                        <p><input type="checkbox"/> Areas with <strong>Steep slopes</strong> greater than 45 % slope</p>
                        <p><input type="checkbox"/> <strong>Conservation Zones</strong> and Easements</p>
                        <p><input type="checkbox"/> Protected <strong>wildpfe habitat</strong>. You must provide point locations for spotted owl nests then a buffer will be applied.</p>
                        <p><input type="checkbox"/> Stands divided by <strong>Roads</strong></p>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#" class="btn" data-dismiss="modal">Cancel</a>
                    <a href="#" class="btn btn-danger" data-dismiss="modal">Refine Boundaries</a>
                </div>
              </div>
            </div>
            <!-- end of stand pages -->
          {% endif %}
          </div>
          <div class="span6">
            <div class="outermap well">
              {% if user.is_authenticated %}
              <!-- Not sure why but non authenticated requests cause failure in geoSearch knockout binding -->
              <div id="searchbox-container" class="pull-right">
                {% include "common/geosearch.html" %}
              </div>
              {% endif %}
              <div id="map"></div>
            </div>
          </div>
        </div>
      </div>
      <!-- end partial -->

{% endblock content %}
{% block scripts %}
    <script type="text/javascript" src="{{MEDIA_URL}}bootstrap/js/jquery.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}common/js/jquery.form.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}common/js/knockout-2.1.0.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}common/js/knockout.mapping-latest.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}bootstrap/js/bootstrap-tooltip.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}bootstrap/js/bootstrap-popover.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}bootstrap/js/bootstrap-modal.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}support/bootstrap/js/bootstrap-dropdown.js"></script>



    <!-- TODO ORGANIZE -->
    <link class="include" rel="stylesheet" type="text/css" href="{{MEDIA_URL}}/jqplot/jquery.jqplot.min.css" />
    <!--[if lt IE 9]><script language="javascript" type="text/javascript" src="{{MEDIA_URL}}/jqplot/excanvas.js"></script><![endif]-->
    <script class="include" type="text/javascript" src="{{MEDIA_URL}}/jqplot/jquery.jqplot.min.js"></script>
    <script class="include" type="text/javascript" src="{{MEDIA_URL}}/jqplot/plugins/jqplot.canvasTextRenderer.min.js"></script>
    <script class="include" type="text/javascript" src="{{MEDIA_URL}}/jqplot/plugins/jqplot.canvasAxisLabelRenderer.min.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}/jqplot/plugins/jqplot.dateAxisRenderer.min.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}/jqplot/plugins/jqplot.highlighter.min.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}/jqplot/plugins/jqplot.enhancedLegendRenderer.min.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}/common/js/chart.js"></script>
    <style>
        .chart { height:250px; width:450px; }
    </style>




    {% load compressed %}
    <script type="text/javascript">
        var madrona = {
            features: {}
        };
        var app = {
            stands: {},
            scenarios: {},
            properties: {}
        };
        {% if user.is_authenticated %}
        $.get('/features/{{user.username}}/workspace-owner.json', function (data) {
            app.workspace = data;
        });
        {% else %}
        $.get('/features/workspace-public.json', function (data) {
            app.workspace = data;
        });
        {% endif %}

    </script>
    <script type="text/javascript" src="{{MEDIA_URL}}features/js/workspace.js"></script>
    <script src="http://maps.google.com/maps/api/js?v=3.5&amp;sensor=false"></script>
    <script src="{{ MEDIA_URL }}OpenLayers.js"></script>
    {% compressed_js 'application' %}
    <script src="{{ MEDIA_URL }}common/js/geosearch.js"></script>
    <script src="{{ MEDIA_URL }}common/js/init.js"></script>
    <script src="{{ MEDIA_URL }}common/js/breadcrumbs.js"></script>
{% endblock scripts %}
